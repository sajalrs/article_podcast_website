{"ast":null,"code":"var _jsxFileName = \"/home/sajalrs/ReactProgramming/article_podcast_website/client/src/components/TextEditor/TextEditor.js\";\nimport React, { useState, useRef } from \"react\";\nimport { Editor, getEventTransfer } from \"slate-react\";\nimport { Block } from \"slate\";\nimport styles from \"./TextEditor.module.css\";\nimport FormatToolbar from \"./FormatToolbar\";\nimport { isKeyHotkey } from \"is-hotkey\";\nimport imageExtensions from \"image-extensions\";\nimport isUrl from \"is-url\";\nconst schema = {\n  document: {\n    last: {\n      type: \"paragraph\"\n    },\n    normalize: (editor, {\n      code,\n      node,\n      child\n    }) => {\n      switch (code) {\n        case \"last_child_type_invalid\":\n          {\n            const paragraph = Block.create(\"paragraph\");\n            return editor.insertNodeByKey(node.key, node.nodes.size, paragraph);\n          }\n      }\n    }\n  },\n  blocks: {\n    image: {\n      isVoid: true\n    }\n  }\n};\n\nconst TextEditor = props => {\n  const ref = useRef();\n  const value = props.value;\n  const setValue = props.setValue;\n  const DEFAULT_NODE = \"paragraph\";\n  const isBoldHotkey = isKeyHotkey(\"mod+b\");\n  const isItalicHotkey = isKeyHotkey(\"mod+i\");\n  const isUnderlinedHotkey = isKeyHotkey(\"mod+u\");\n  const isCodeHotkey = isKeyHotkey(\"mod+`\");\n  const isTabHotkey = isKeyHotkey(\"tab\");\n\n  const isImage = url => {\n    return imageExtensions.includes(getExtension(url));\n  };\n\n  const getExtension = url => {\n    return new URL(url).pathname.split(\".\").pop;\n  };\n\n  const insertImage = (editor, src, target) => {\n    if (target) {\n      editor.select(target);\n    }\n\n    editor.insertBlock({\n      type: \"image\",\n      data: {\n        src\n      }\n    });\n  };\n\n  const insertFigure = (editor, src, target) => {\n    if (target) {\n      editor.select(target);\n    }\n\n    editor.insertBlock({\n      type: \"figure\",\n      data: {\n        src\n      }\n    });\n  };\n\n  const renderBlock = (props, editor, next) => {\n    const {\n      attributes,\n      children,\n      node\n    } = props;\n\n    switch (node.type) {\n      case \"paragraph\":\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: styles[\"main-pane-item\"],\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 79,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"p\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 13\n          }\n        }, children));\n\n      case \"block-quote\":\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: styles[\"main-pane-item\"],\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"blockquote\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 13\n          }\n        }, children));\n\n      case \"bulleted-list\":\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: styles[\"main-pane-item\"],\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 91,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"ul\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 13\n          }\n        }, children));\n\n      case \"heading-one\":\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: styles[\"main-pane-item\"],\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"h1\", {\n          className: styles[\"heading\"],\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 13\n          }\n        }, children));\n\n      case \"heading-two\":\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: styles[\"main-pane-item\"],\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"h2\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 13\n          }\n        }, children));\n\n      case \"list-item\":\n        return /*#__PURE__*/React.createElement(\"li\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 16\n          }\n        }, children);\n\n      case \"numbered-list\":\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: styles[\"main-pane-item\"],\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 111,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"ol\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 13\n          }\n        }, children));\n\n      case \"image\":\n        {\n          const src = node.data.get(\"src\");\n          return /*#__PURE__*/React.createElement(\"div\", {\n            className: styles[\"main-pane-item\"],\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 118,\n              columnNumber: 11\n            }\n          }, /*#__PURE__*/React.createElement(\"figure\", {\n            className: styles[\"image-container\"],\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 119,\n              columnNumber: 13\n            }\n          }, /*#__PURE__*/React.createElement(\"img\", {\n            src: src,\n            loading: \"lazy\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 120,\n              columnNumber: 15\n            }\n          })));\n        }\n\n      case \"figure\":\n        {\n          const src = node.data.get(\"src\");\n          return /*#__PURE__*/React.createElement(\"div\", {\n            className: styles[\"main-pane-item\"],\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 11\n            }\n          }, /*#__PURE__*/React.createElement(\"figure\", {\n            className: styles[\"image-container\"],\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 13\n            }\n          }, /*#__PURE__*/React.createElement(\"img\", {\n            src: src,\n            loading: \"lazy\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 130,\n              columnNumber: 15\n            }\n          }), /*#__PURE__*/React.createElement(\"figcaption\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 131,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(\"strong\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 132,\n              columnNumber: 17\n            }\n          }, children))));\n        }\n\n      default:\n        return next();\n    }\n  };\n\n  const renderMark = (props, editor, next) => {\n    const {\n      children,\n      mark,\n      attributes\n    } = props;\n\n    switch (mark.type) {\n      case \"bold\":\n        return /*#__PURE__*/React.createElement(\"strong\", Object.assign({}, attributes, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 148,\n            columnNumber: 16\n          }\n        }), children);\n\n      case \"code\":\n        return /*#__PURE__*/React.createElement(\"code\", Object.assign({}, attributes, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 16\n          }\n        }), children);\n\n      case \"italic\":\n        return /*#__PURE__*/React.createElement(\"em\", Object.assign({}, attributes, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 16\n          }\n        }), children);\n\n      case \"underlined\":\n        return /*#__PURE__*/React.createElement(\"u\", Object.assign({}, attributes, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 16\n          }\n        }), children);\n\n      default:\n        return next();\n    }\n  };\n\n  const onKeyDown = (event, editor, next) => {\n    let mark;\n\n    if (isBoldHotkey(event)) {\n      mark = \"bold\";\n    } else if (isItalicHotkey(event)) {\n      mark = \"italic\";\n    } else if (isUnderlinedHotkey(event)) {\n      mark = \"underlined\";\n    } else if (isCodeHotkey(event)) {\n      mark = \"code\";\n    } else if (isTabHotkey(event)) {\n      event.preventDefault();\n      return next();\n    } else {\n      return next();\n    }\n\n    event.preventDefault();\n    editor.toggleMark(mark);\n  };\n\n  const onDropOrPaste = (event, editor, next) => {\n    const target = editor.findEventRange(event);\n    if (!target && event.type === \"drop\") return next();\n    const transfer = getEventTransfer(event);\n    const {\n      type,\n      text,\n      files\n    } = transfer;\n\n    if (type === \"files\") {\n      for (const file of files) {\n        const reader = new FileReader();\n        const [mime] = file.type.split(\"/\");\n        if (mime !== \"image\") continue;\n        reader.addEventListener(\"load\", () => {\n          editor.command(insertImage, reader.result, target);\n        });\n        reader.readAsDataURL(file);\n      }\n\n      return;\n    }\n\n    if (type === \"text\") {\n      if (!isUrl(text)) return next();\n      if (!isImage(text)) return next();\n      editor.command(insertImage, text, target);\n      return;\n    }\n\n    next();\n  };\n\n  const renderOnceToolbar = /*#__PURE__*/React.createElement(FormatToolbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 5\n    }\n  });\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: styles[\"overarching\"],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 5\n    }\n  }, props.toolbarFixed ? /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      position: \"fixed\",\n      top: \"66px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 9\n    }\n  }, renderOnceToolbar) : /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 9\n    }\n  }, renderOnceToolbar), /*#__PURE__*/React.createElement(Editor, {\n    ref: ref,\n    className: styles[\"Editor\"],\n    value: value,\n    onChange: opts => setValue(opts.value),\n    onKeyDown: onKeyDown,\n    renderMark: renderMark,\n    renderBlock: renderBlock,\n    onDrop: onDropOrPaste,\n    schema: schema,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 7\n    }\n  }));\n};\n\nconst BLOCK_TAGS = {\n  p: \"paragraph\",\n  blockquote: \"block-quote\",\n  ul: `bulleted-list`,\n  h1: `heading-one`,\n  h2: `heading-two`,\n  li: `list-item`,\n  ol: `numbered-list`,\n  img: `image`\n}; // Add a dictionary of mark tags.\n\nconst MARK_TAGS = {\n  em: \"italic\",\n  strong: \"bold\",\n  u: \"underlined\",\n  code: `code`\n};\nexport const rules = [{\n  deserialize(el, next) {\n    const type = BLOCK_TAGS[el.tagName.toLowerCase()];\n\n    if (type) {\n      return {\n        object: \"block\",\n        type: type,\n        data: {\n          className: el.getAttribute(\"class\")\n        },\n        nodes: next(el.childNodes)\n      };\n    }\n  },\n\n  serialize(obj, children) {\n    if (obj.object == \"block\") {\n      switch (obj.type) {\n        case \"paragraph\":\n          return /*#__PURE__*/React.createElement(\"di\", {\n            className: styles[\"main-pane\"],\n            v: true,\n            className: styles[\"main-pane-item\"],\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 286,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(\"p\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 17\n            }\n          }, children));\n\n        case \"block-quote\":\n          return /*#__PURE__*/React.createElement(\"div\", {\n            className: `${styles[\"main-pane-item\"]}`,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 296,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(\"blockquote\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 297,\n              columnNumber: 17\n            }\n          }, children));\n\n        case \"bulleted-list\":\n          return /*#__PURE__*/React.createElement(\"div\", {\n            className: styles[\"main-pane-item\"],\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(\"ul\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 303,\n              columnNumber: 17\n            }\n          }, children));\n\n        case \"heading-one\":\n          return /*#__PURE__*/React.createElement(\"div\", {\n            className: styles[\"main-pane-item\"],\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 308,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(\"h1\", {\n            className: styles[\"heading\"],\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 309,\n              columnNumber: 17\n            }\n          }, children));\n\n        case \"heading-two\":\n          return /*#__PURE__*/React.createElement(\"div\", {\n            className: styles[\"main-pane-item\"],\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 314,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(\"h2\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 17\n            }\n          }, children));\n\n        case \"list-item\":\n          return /*#__PURE__*/React.createElement(\"li\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 319,\n              columnNumber: 20\n            }\n          }, children);\n\n        case \"numbered-list\":\n          return /*#__PURE__*/React.createElement(\"div\", {\n            className: styles[\"main-pane-item\"],\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 322,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(\"ol\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 323,\n              columnNumber: 17\n            }\n          }, children));\n\n        case \"image\":\n          {\n            const src = obj.data[\"src\"];\n            return /*#__PURE__*/React.createElement(\"div\", {\n              className: `${styles[\"main-pane-item\"]}`,\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 329,\n                columnNumber: 15\n              }\n            }, /*#__PURE__*/React.createElement(\"figure\", {\n              className: styles[\"image-container\"],\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 330,\n                columnNumber: 17\n              }\n            }, /*#__PURE__*/React.createElement(\"img\", {\n              src: src,\n              loading: \"lazy\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 331,\n                columnNumber: 19\n              }\n            })));\n          }\n\n        case \"figure\":\n          {\n            const src = obj.data[\"src\"];\n            return /*#__PURE__*/React.createElement(\"div\", {\n              className: `${styles[\"main-pane-item\"]}`,\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 339,\n                columnNumber: 15\n              }\n            }, /*#__PURE__*/React.createElement(\"figure\", {\n              className: styles[\"image-container\"],\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 340,\n                columnNumber: 17\n              }\n            }, /*#__PURE__*/React.createElement(\"img\", {\n              src: src,\n              loading: \"lazy\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 341,\n                columnNumber: 19\n              }\n            }), /*#__PURE__*/React.createElement(\"figcaption\", {\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 342,\n                columnNumber: 19\n              }\n            }, /*#__PURE__*/React.createElement(\"strong\", {\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 343,\n                columnNumber: 21\n              }\n            }, children))));\n          }\n      }\n    }\n  }\n\n}, // Add a new rule that handles marks...\n{\n  deserialize(el, next) {\n    const type = MARK_TAGS[el.tagName.toLowerCase()];\n\n    if (type) {\n      return {\n        object: \"mark\",\n        type: type,\n        nodes: next(el.childNodes)\n      };\n    }\n  },\n\n  serialize(obj, children) {\n    if (obj.object == \"mark\") {\n      switch (obj.type) {\n        case \"bold\":\n          return /*#__PURE__*/React.createElement(\"strong\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 20\n            }\n          }, children);\n\n        case \"italic\":\n          return /*#__PURE__*/React.createElement(\"em\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 371,\n              columnNumber: 20\n            }\n          }, children);\n\n        case \"code\":\n          return /*#__PURE__*/React.createElement(\"code\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 373,\n              columnNumber: 20\n            }\n          }, children);\n\n        case \"underlined\":\n          return /*#__PURE__*/React.createElement(\"u\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 375,\n              columnNumber: 20\n            }\n          }, children);\n      }\n    }\n  }\n\n}];\nexport const hasMark = type => {\n  return value.activeMarks.some(mark => mark.type === type);\n};\nexport const hasBlock = type => {\n  return value.blocks.some(node => node.type === type);\n};\nexport const onClickMark = (event, type) => {\n  event.preventDefault();\n  ref.current.toggleMark(type);\n};\nexport const onClickImage = event => {\n  event.preventDefault();\n  const src = window.prompt(\"enter the URL of the image:\"); // const caption = window.prompt(\"enter a caption for the image\")\n\n  if (!src) return;\n  ref.current.command(insertImage, src);\n};\nexport const onClickFigure = event => {\n  event.preventDefault();\n  const src = window.prompt(\"enter the URL of the image:\");\n  if (!src) return;\n  ref.current.command(insertFigure, src);\n};\nexport const onClickBlock = (event, type) => {\n  event.preventDefault();\n  const editor = ref.current;\n  const value = editor.value;\n  const document = value.document; // Handle everything but list buttons.\n\n  if (type !== \"bulleted-list\" && type !== \"numbered-list\") {\n    const isActive = hasBlock(type);\n    const isList = hasBlock(\"list-item\");\n\n    if (isList) {\n      editor.setBlocks(isActive ? DEFAULT_NODE : type).unwrapBlock(\"bulleted-list\").unwrapBlock(\"numbered-list\");\n    } else {\n      editor.setBlocks(isActive ? DEFAULT_NODE : type);\n    }\n  } else {\n    // Handle the extra wrapping required for list buttons.\n    const isList = hasBlock(\"list-item\");\n    const isType = value.blocks.some(block => {\n      return !!document.getClosest(block.key, parent => parent.type === type);\n    });\n\n    if (isList && isType) {\n      editor.setBlocks(DEFAULT_NODE).unwrapBlock(\"bulleted-list\").unwrapBlock(\"numbered-list\");\n    } else if (isList) {\n      editor.unwrapBlock(type === \"bulleted-list\" ? \"numbered-list\" : \"bulleted-list\").wrapBlock(type);\n    } else {\n      editor.setBlocks(\"list-item\").wrapBlock(type);\n    }\n  }\n};\nexport default TextEditor;","map":{"version":3,"sources":["/home/sajalrs/ReactProgramming/article_podcast_website/client/src/components/TextEditor/TextEditor.js"],"names":["React","useState","useRef","Editor","getEventTransfer","Block","styles","FormatToolbar","isKeyHotkey","imageExtensions","isUrl","schema","document","last","type","normalize","editor","code","node","child","paragraph","create","insertNodeByKey","key","nodes","size","blocks","image","isVoid","TextEditor","props","ref","value","setValue","DEFAULT_NODE","isBoldHotkey","isItalicHotkey","isUnderlinedHotkey","isCodeHotkey","isTabHotkey","isImage","url","includes","getExtension","URL","pathname","split","pop","insertImage","src","target","select","insertBlock","data","insertFigure","renderBlock","next","attributes","children","get","renderMark","mark","onKeyDown","event","preventDefault","toggleMark","onDropOrPaste","findEventRange","transfer","text","files","file","reader","FileReader","mime","addEventListener","command","result","readAsDataURL","renderOnceToolbar","toolbarFixed","position","top","opts","BLOCK_TAGS","p","blockquote","ul","h1","h2","li","ol","img","MARK_TAGS","em","strong","u","rules","deserialize","el","tagName","toLowerCase","object","className","getAttribute","childNodes","serialize","obj","hasMark","activeMarks","some","hasBlock","onClickMark","current","onClickImage","window","prompt","onClickFigure","onClickBlock","isActive","isList","setBlocks","unwrapBlock","isType","block","getClosest","parent","wrapBlock"],"mappings":"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","sourcesContent":["import React, { useState, useRef } from \"react\";\nimport { Editor, getEventTransfer } from \"slate-react\";\nimport { Block } from \"slate\";\nimport styles from \"./TextEditor.module.css\";\nimport FormatToolbar from \"./FormatToolbar\";\nimport { isKeyHotkey } from \"is-hotkey\";\nimport imageExtensions from \"image-extensions\";\nimport isUrl from \"is-url\";\n\nconst schema = {\n  document: {\n    last: { type: \"paragraph\" },\n    normalize: (editor, { code, node, child }) => {\n      switch (code) {\n        case \"last_child_type_invalid\": {\n          const paragraph = Block.create(\"paragraph\");\n          return editor.insertNodeByKey(node.key, node.nodes.size, paragraph);\n        }\n      }\n    },\n  },\n  blocks: {\n    image: {\n      isVoid: true,\n    },\n  },\n};\n\nconst TextEditor = (props) => {\n  const ref = useRef();\n  const value = props.value;\n  const setValue = props.setValue;\n  const DEFAULT_NODE = \"paragraph\";\n  const isBoldHotkey = isKeyHotkey(\"mod+b\");\n  const isItalicHotkey = isKeyHotkey(\"mod+i\");\n  const isUnderlinedHotkey = isKeyHotkey(\"mod+u\");\n  const isCodeHotkey = isKeyHotkey(\"mod+`\");\n  const isTabHotkey = isKeyHotkey(\"tab\");\n\n  \n\n  const isImage = (url) => {\n    return imageExtensions.includes(getExtension(url));\n  };\n\n  const getExtension = (url) => {\n    return new URL(url).pathname.split(\".\").pop;\n  };\n\n  const insertImage = (editor, src, target) => {\n    if (target) {\n      editor.select(target);\n    }\n\n    editor.insertBlock({\n      type: \"image\",\n      data: { src },\n    });\n  };\n\n  const insertFigure = (editor, src, target) => {\n    if (target) {\n      editor.select(target);\n    }\n\n    editor.insertBlock({\n      type: \"figure\",\n      data: { src },\n    });\n  };\n\n\n  const renderBlock = (props, editor, next) => {\n    const { attributes, children, node } = props;\n\n    switch (node.type) {\n      case \"paragraph\":\n        return (\n          <div className={styles[\"main-pane-item\"]}>\n            <p>{children}</p>\n          </div>\n        );\n      case \"block-quote\":\n        return (\n          <div className={styles[\"main-pane-item\"]}>\n            <blockquote>{children}</blockquote>\n          </div>\n        );\n      case \"bulleted-list\":\n        return (\n          <div className={styles[\"main-pane-item\"]}>\n            <ul>{children}</ul>\n          </div>\n        );\n      case \"heading-one\":\n        return (\n          <div className={styles[\"main-pane-item\"]}>\n            <h1 className={styles[\"heading\"]}>{children}</h1>\n          </div>\n        );\n      case \"heading-two\":\n        return (\n          <div className={styles[\"main-pane-item\"]}>\n            <h2>{children}</h2>\n          </div>\n        );\n      case \"list-item\":\n        return <li>{children}</li>;\n      case \"numbered-list\":\n        return (\n          <div className={styles[\"main-pane-item\"]}>\n            <ol>{children}</ol>\n          </div>\n        );\n      case \"image\": {\n        const src = node.data.get(\"src\");\n        return (\n          <div className={styles[\"main-pane-item\"]}>\n            <figure className={styles[\"image-container\"]}>\n              <img src={src} loading=\"lazy\" />\n            </figure>\n          </div>\n        );\n      }\n      case \"figure\": {\n        const src = node.data.get(\"src\");\n        return (\n          <div className={styles[\"main-pane-item\"]}>\n            <figure className={styles[\"image-container\"]}>\n              <img src={src} loading=\"lazy\" />\n              <figcaption>\n                <strong>{children}</strong>\n              </figcaption>\n            </figure>\n          </div>\n        );\n      }\n      default:\n        return next();\n    }\n  };\n\n  const renderMark = (props, editor, next) => {\n    const { children, mark, attributes } = props;\n\n    switch (mark.type) {\n      case \"bold\":\n        return <strong {...attributes}>{children}</strong>;\n      case \"code\":\n        return <code {...attributes}>{children}</code>;\n      case \"italic\":\n        return <em {...attributes}>{children}</em>;\n      case \"underlined\":\n        return <u {...attributes}>{children}</u>;\n      default:\n        return next();\n    }\n  };\n\n  const onKeyDown = (event, editor, next) => {\n    let mark;\n\n    if (isBoldHotkey(event)) {\n      mark = \"bold\";\n    } else if (isItalicHotkey(event)) {\n      mark = \"italic\";\n    } else if (isUnderlinedHotkey(event)) {\n      mark = \"underlined\";\n    } else if (isCodeHotkey(event)) {\n      mark = \"code\";\n    } else if (isTabHotkey(event)) {\n      event.preventDefault();\n      return next();\n    } else {\n      return next();\n    }\n\n    event.preventDefault();\n    editor.toggleMark(mark);\n  };\n\n  \n\n  const onDropOrPaste = (event, editor, next) => {\n    const target = editor.findEventRange(event);\n    if (!target && event.type === \"drop\") return next();\n\n    const transfer = getEventTransfer(event);\n    const { type, text, files } = transfer;\n\n    if (type === \"files\") {\n      for (const file of files) {\n        const reader = new FileReader();\n        const [mime] = file.type.split(\"/\");\n        if (mime !== \"image\") continue;\n\n        reader.addEventListener(\"load\", () => {\n          editor.command(insertImage, reader.result, target);\n        });\n\n        reader.readAsDataURL(file);\n      }\n      return;\n    }\n\n    if (type === \"text\") {\n      if (!isUrl(text)) return next();\n      if (!isImage(text)) return next();\n      editor.command(insertImage, text, target);\n      return;\n    }\n\n    next();\n  };\n\n  const renderOnceToolbar = (\n    <FormatToolbar>\n     \n    </FormatToolbar>\n  );\n\n  return (\n    <div className={styles[\"overarching\"]}>\n      {props.toolbarFixed ? (\n        <div style={{ position: \"fixed\", top: \"66px\" }}>\n          {/* <div style={{ position: \"fixed\", top: \"103.5px\", right: \"0px\"}}> */}\n          {renderOnceToolbar}\n        </div>\n      ) : (\n        <div>{renderOnceToolbar}</div>\n      )}\n      <Editor\n        ref={ref}\n        className={styles[\"Editor\"]}\n        value={value}\n        onChange={(opts) => setValue(opts.value)}\n        onKeyDown={onKeyDown}\n        renderMark={renderMark}\n        renderBlock={renderBlock}\n        onDrop={onDropOrPaste}\n        schema={schema}\n      />\n    </div>\n  );\n};\n\nconst BLOCK_TAGS = {\n  p: \"paragraph\",\n  blockquote: \"block-quote\",\n  ul: `bulleted-list`,\n  h1: `heading-one`,\n  h2: `heading-two`,\n  li: `list-item`,\n  ol: `numbered-list`,\n  img: `image`,\n};\n\n// Add a dictionary of mark tags.\nconst MARK_TAGS = {\n  em: \"italic\",\n  strong: \"bold\",\n  u: \"underlined\",\n  code: `code`,\n};\n\nexport const rules = [\n  {\n    deserialize(el, next) {\n      const type = BLOCK_TAGS[el.tagName.toLowerCase()];\n      if (type) {\n        return {\n          object: \"block\",\n          type: type,\n          data: {\n            className: el.getAttribute(\"class\"),\n          },\n          nodes: next(el.childNodes),\n        };\n      }\n    },\n    serialize(obj, children) {\n      if (obj.object == \"block\") {\n        switch (obj.type) {\n          case \"paragraph\":\n            return (\n              <di\n                className={styles[\"main-pane\"]}\n                v\n                className={styles[\"main-pane-item\"]}\n              >\n                <p>{children}</p>\n              </di>\n            );\n          case \"block-quote\":\n            return (\n              <div className={`${styles[\"main-pane-item\"]}`}>\n                <blockquote>{children}</blockquote>\n              </div>\n            );\n          case \"bulleted-list\":\n            return (\n              <div className={styles[\"main-pane-item\"]}>\n                <ul>{children}</ul>\n              </div>\n            );\n          case \"heading-one\":\n            return (\n              <div className={styles[\"main-pane-item\"]}>\n                <h1 className={styles[\"heading\"]}>{children}</h1>\n              </div>\n            );\n          case \"heading-two\":\n            return (\n              <div className={styles[\"main-pane-item\"]}>\n                <h2>{children}</h2>\n              </div>\n            );\n          case \"list-item\":\n            return <li>{children}</li>;\n          case \"numbered-list\":\n            return (\n              <div className={styles[\"main-pane-item\"]}>\n                <ol>{children}</ol>\n              </div>\n            );\n          case \"image\": {\n            const src = obj.data[\"src\"];\n            return (\n              <div className={`${styles[\"main-pane-item\"]}`}>\n                <figure className={styles[\"image-container\"]}>\n                  <img src={src} loading=\"lazy\" />\n                </figure>\n              </div>\n            );\n          }\n          case \"figure\": {\n            const src = obj.data[\"src\"];\n            return (\n              <div className={`${styles[\"main-pane-item\"]}`}>\n                <figure className={styles[\"image-container\"]}>\n                  <img src={src} loading=\"lazy\" />\n                  <figcaption>\n                    <strong>{children}</strong>\n                  </figcaption>\n                </figure>\n              </div>\n            );\n          }\n        }\n      }\n    },\n  },\n  // Add a new rule that handles marks...\n  {\n    deserialize(el, next) {\n      const type = MARK_TAGS[el.tagName.toLowerCase()];\n      if (type) {\n        return {\n          object: \"mark\",\n          type: type,\n          nodes: next(el.childNodes),\n        };\n      }\n    },\n    serialize(obj, children) {\n      if (obj.object == \"mark\") {\n        switch (obj.type) {\n          case \"bold\":\n            return <strong>{children}</strong>;\n          case \"italic\":\n            return <em>{children}</em>;\n          case \"code\":\n            return <code>{children}</code>;\n          case \"underlined\":\n            return <u>{children}</u>;\n        }\n      }\n    },\n  },\n];\n\nexport const hasMark = (type) => {\n  return value.activeMarks.some((mark) => mark.type === type);\n};\n\nexport const hasBlock = (type) => {\n  return value.blocks.some((node) => node.type === type);\n};\n\nexport const onClickMark = (event, type) => {\n  event.preventDefault();\n  ref.current.toggleMark(type);\n};\n\nexport const onClickImage = (event) => {\n  event.preventDefault();\n  const src = window.prompt(\"enter the URL of the image:\");\n  // const caption = window.prompt(\"enter a caption for the image\")\n  if (!src) return;\n  ref.current.command(insertImage, src);\n};\n\nexport const onClickFigure = (event) => {\n  event.preventDefault();\n  const src = window.prompt(\"enter the URL of the image:\");\n  if (!src) return;\n  ref.current.command(insertFigure, src);\n};\n\nexport const onClickBlock = (event, type) => {\n  event.preventDefault();\n\n  const editor = ref.current;\n  const value = editor.value;\n  const document = value.document;\n\n  // Handle everything but list buttons.\n  if (type !== \"bulleted-list\" && type !== \"numbered-list\") {\n    const isActive = hasBlock(type);\n    const isList = hasBlock(\"list-item\");\n\n    if (isList) {\n      editor\n        .setBlocks(isActive ? DEFAULT_NODE : type)\n        .unwrapBlock(\"bulleted-list\")\n        .unwrapBlock(\"numbered-list\");\n    } else {\n      editor.setBlocks(isActive ? DEFAULT_NODE : type);\n    }\n  } else {\n    // Handle the extra wrapping required for list buttons.\n    const isList = hasBlock(\"list-item\");\n    const isType = value.blocks.some((block) => {\n      return !!document.getClosest(\n        block.key,\n        (parent) => parent.type === type\n      );\n    });\n\n    if (isList && isType) {\n      editor\n        .setBlocks(DEFAULT_NODE)\n        .unwrapBlock(\"bulleted-list\")\n        .unwrapBlock(\"numbered-list\");\n    } else if (isList) {\n      editor\n        .unwrapBlock(\n          type === \"bulleted-list\" ? \"numbered-list\" : \"bulleted-list\"\n        )\n        .wrapBlock(type);\n    } else {\n      editor.setBlocks(\"list-item\").wrapBlock(type);\n    }\n  }\n};\n\n\nexport default TextEditor;\n"]},"metadata":{},"sourceType":"module"}