{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  mutation editArticle(\\n    $_id: String!\\n    $title: String!\\n    $author: String!\\n    $date: String\\n    $image: String!\\n    $content: String!\\n  ) {\\n    editArticle(\\n      _id: $_id\\n      title: $title\\n      author: $author\\n      date: $date\\n      image: $image\\n      content: $content\\n    ) {\\n      _id\\n      date\\n      image\\n      title\\n      author\\n      authorId\\n      isApproved\\n      content\\n      comments {\\n        _id\\n        authorId\\n        author\\n        content\\n        createdAt\\n        updatedAt\\n      }\\n    }\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState, useEffect, useMemo, useRef, useContext } from \"react\";\nimport LargeCard from \"../../components/Cards/LargeCard/LargeCard.js\";\nimport Page from \"../../components/Page/Page\";\nimport styles from \"../../components/Page/Page.module.css\";\nimport TextEditor from \"../../components/TextEditor/TextEditor\";\nimport { Value } from \"slate\";\nimport DatePicker from \"react-datepicker\";\nimport { HeaderContext } from \"../../contexts/reducers/headerContext\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport axios from \"axios\";\nimport { Card } from \"../../components/Cards/Card\";\nimport { gql, useQuery, useMutation, NetworkStatus } from \"@apollo/client\";\nimport { ARTICLE_QUERY } from \"./index\";\nimport { useRouter } from \"next/router\";\nimport Html from \"slate-html-serializer\";\nimport { getRules } from \"../../components/TextEditor/TextEditor\";\nexport var __N_SSP = true;\nexport var EDIT_ARTICLE_MUTATION = gql(_templateObject()); //TO Both Moderators and posters get same message when saving. Needs to change\n\nvar initialValue = {\n  document: {\n    nodes: [{\n      object: \"block\",\n      type: \"paragraph\",\n      nodes: [{\n        object: \"text\",\n        leaves: [{\n          text: \"Edit text and save to submit for moderator approval...\"\n        }]\n      }]\n    }]\n  }\n};\n\nvar Edit = function Edit(props) {\n  _s();\n\n  var router = useRouter();\n  var id = router.query.id;\n\n  var _useState = useState(Value.fromJSON(initialValue)),\n      textEditorValue = _useState[0],\n      setTextEditorValue = _useState[1];\n\n  var _useState2 = useState({\n    title: \"To be edited\",\n    author: \"To be edited\",\n    date: new Date(),\n    image: \"data:image/png;base64,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\"\n  }),\n      formData = _useState2[0],\n      setFormData = _useState2[1];\n\n  var _useState3 = useState(\"data:image/png;base64,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}\"),\n      image = _useState3[0],\n      setImage = _useState3[1];\n\n  var _useQuery = useQuery(ARTICLE_QUERY, {\n    variables: {\n      _id: id\n    },\n    notifyOnNetworkStatusChange: true\n  }),\n      loading = _useQuery.loading,\n      error = _useQuery.error,\n      fetchMore = _useQuery.fetchMore,\n      data = _useQuery.data,\n      networkStatus = _useQuery.networkStatus,\n      refetch = _useQuery.refetch;\n\n  var loadingArticle = networkStatus === NetworkStatus.fetchMore;\n  var article;\n\n  if (loading && !loadingArticle) {\n    article = {};\n  } else {\n    article = _objectSpread(_objectSpread({}, data.article), {}, {\n      date: JSON.parse(data.article.date),\n      content: data.article.content ? JSON.parse(data.article.content) : initialValue,\n      comments: data.article.comments.map(function (comment) {\n        return _objectSpread(_objectSpread({}, comment), {}, {\n          content: JSON.parse(comment.content),\n          createdAt: JSON.parse(comment.createdAt),\n          updatedAt: JSON.parse(comment.updatedAt)\n        });\n      })\n    });\n  }\n\n  useMemo(function () {\n    return setTextEditorValue(Value.fromJSON(article.content));\n  }, article.content);\n\n  var _useMutation = useMutation(EDIT_ARTICLE_MUTATION),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      saveEditedArticle = _useMutation2[0],\n      _ = _useMutation2[1]._;\n\n  var _useContext = useContext(HeaderContext),\n      headerState = _useContext[0],\n      headerDispatch = _useContext[1];\n\n  var headerBoxRef = headerState.headerBoxRef;\n\n  var _useState4 = useState(false),\n      toolbarFixed = _useState4[0],\n      setToolbarFix = _useState4[1];\n\n  var headlineFormRef = useRef();\n  useEffect(function () {\n    var height = headerBoxRef && headerBoxRef.current ? headerBoxRef.current.clientHeight : 380;\n\n    var fixToolbar = function fixToolbar(e) {\n      if (window.scrollY > 2 * height - 66 + 644) {\n        setToolbarFix(true);\n      } else {\n        setToolbarFix(false);\n      }\n    };\n\n    window.addEventListener(\"scroll\", fixToolbar);\n    return function () {\n      window.removeEventListener(\"scroll\", fixToolbar);\n    };\n  }, [toolbarFixed]);\n  useEffect(function () {\n    setFormData({\n      title: article.title,\n      author: article.author,\n      date: new Date(article.date),\n      image: article.image\n    });\n    setImage(article.image);\n  }, [article.title, article.author, article.author, article.date, article.image]);\n  useEffect(function () {\n    var keyDownHandler = function keyDownHandler(e) {\n      if (e.keyCode === 83 && e.ctrlKey) {\n        e.preventDefault();\n        saveArticle();\n      }\n    };\n\n    document.addEventListener(\"keydown\", keyDownHandler);\n    return function () {\n      document.removeEventListener(\"keydown\", keyDownHandler);\n    };\n  }, [article, textEditorValue]);\n  useEffect(function () {\n    window.scrollTo(0, 0);\n  }, []);\n\n  var saveArticle = function saveArticle() {\n    saveEditedArticle({\n      variables: {\n        _id: id,\n        title: formData.title,\n        author: formData.author,\n        date: JSON.stringify(article.date),\n        image: image,\n        content: JSON.stringify(textEditorValue.toJSON())\n      }\n    }); // const editedArticle = { ...article, content: textEditorValue.toJSON() };\n    // const options = {\n    //   headers: { \"Content-Type\": \"application/json\" },\n    // };\n    // axios\n    //   .post(\"/api/articles/edit\", JSON.stringify(editedArticle), options)\n    //   .then((res) => {\n    //     alert(\"Changes saved and submitted for moderator approval\");\n    //   })\n    //   .catch((err) => {\n    //     if (err.response.status === 401 || err.response.status === 400) {\n    //       alert(err.response.data.error);\n    //     } else if (err.response.status !== 200) {\n    //       throw Error(err);\n    //     }\n    //   });\n  };\n\n  var onTitleChange = function onTitleChange(event) {\n    setFormData(_objectSpread(_objectSpread({}, formData), {}, {\n      title: event.target.value\n    }));\n  };\n\n  var onAuthorChange = function onAuthorChange(event) {\n    setFormData(_objectSpread(_objectSpread({}, formData), {}, {\n      author: event.target.value\n    }));\n  };\n\n  var onDateChange = function onDateChange(newDate) {\n    setFormData(_objectSpread(_objectSpread({}, formData), {}, {\n      date: newDate\n    }));\n  };\n\n  var onImageChange = function onImageChange(event) {\n    setFormData(_objectSpread(_objectSpread({}, formData), {}, {\n      image: event.target.value\n    }));\n  };\n\n  var isPendingApproval = !article.isApproved;\n\n  var headline = __jsx(\"div\", {\n    className: styles[\"headline\"],\n    style: isPendingApproval ? {\n      marginTop: \"36px\"\n    } : {\n      marginTop: \"0px\"\n    }\n  }, __jsx(LargeCard, {\n    title: formData.title,\n    author: formData.author,\n    date: formData.date,\n    isApproved: article.isApproved,\n    contentType: Card.ContentType[\"article-internal\"],\n    image: image,\n    onClick: function onClick() {}\n  }));\n\n  var handleSubmit = function handleSubmit(event) {\n    event.preventDefault();\n    setImage(formData.image);\n  };\n\n  var contents = __jsx(\"div\", null, __jsx(\"form\", {\n    ref: headlineFormRef,\n    onSubmit: handleSubmit,\n    className: styles[\"headline-form\"]\n  }, __jsx(\"div\", {\n    className: styles[\"horizontal\"]\n  }, __jsx(\"label\", null, \"Title: \"), __jsx(\"input\", {\n    className: styles[\"headline-form-input\"],\n    type: \"text\",\n    value: formData.title,\n    onChange: onTitleChange\n  })), __jsx(\"div\", {\n    className: styles[\"horizontal-same-line\"]\n  }, __jsx(\"div\", {\n    className: styles[\"horizontal\"]\n  }, __jsx(\"label\", null, \"Author: \"), __jsx(\"input\", {\n    className: \"\".concat(styles[\"headline-form-input\"]),\n    type: \"text\",\n    value: formData.author,\n    onChange: onAuthorChange\n  })), __jsx(\"div\", {\n    className: styles[\"horizontal\"]\n  }, __jsx(\"label\", null, \"Date: \"), __jsx(DatePicker, {\n    className: \"\".concat(styles[\"DatePicker\"]),\n    selected: formData.date,\n    onChange: onDateChange\n  }))), __jsx(\"div\", {\n    className: styles[\"horizontal\"]\n  }, __jsx(\"label\", null, \"Image: \"), __jsx(\"input\", {\n    className: styles[\"headline-form-input\"],\n    type: \"text\",\n    value: formData.image,\n    onChange: onImageChange\n  })), __jsx(\"input\", {\n    type: \"submit\",\n    value: \"Change Image\",\n    className: styles[\"submit-button\"]\n  })), __jsx(TextEditor, {\n    value: textEditorValue,\n    setValue: setTextEditorValue,\n    onSave: saveArticle,\n    toolbarFixed: toolbarFixed,\n    styles: styles\n  }));\n\n  return __jsx(Page, {\n    sidebarFixTopOffset: 0,\n    headline: headline,\n    mainPane: contents\n  });\n};\n\n_s(Edit, \"YPxpYooKTxmBXsp2SIztlkaEGik=\", false, function () {\n  return [useRouter, useQuery, useMutation];\n});\n\n_c = Edit;\nexport default Edit;\n\nvar _c;\n\n$RefreshReg$(_c, \"Edit\");","map":{"version":3,"sources":["/home/sajalrs/ReactProgramming/article_podcast_website/pages/article/edit.js"],"names":["React","useState","useEffect","useMemo","useRef","useContext","LargeCard","Page","styles","TextEditor","Value","DatePicker","HeaderContext","axios","Card","gql","useQuery","useMutation","NetworkStatus","ARTICLE_QUERY","useRouter","Html","getRules","EDIT_ARTICLE_MUTATION","initialValue","document","nodes","object","type","leaves","text","Edit","props","router","id","query","fromJSON","textEditorValue","setTextEditorValue","title","author","date","Date","image","formData","setFormData","setImage","variables","_id","notifyOnNetworkStatusChange","loading","error","fetchMore","data","networkStatus","refetch","loadingArticle","article","JSON","parse","content","comments","map","comment","createdAt","updatedAt","saveEditedArticle","_","headerState","headerDispatch","headerBoxRef","toolbarFixed","setToolbarFix","headlineFormRef","height","current","clientHeight","fixToolbar","e","window","scrollY","addEventListener","removeEventListener","keyDownHandler","keyCode","ctrlKey","preventDefault","saveArticle","scrollTo","stringify","toJSON","onTitleChange","event","target","value","onAuthorChange","onDateChange","newDate","onImageChange","isPendingApproval","isApproved","headline","marginTop","ContentType","handleSubmit","contents"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useMemo, useRef, useContext } from \"react\";\nimport LargeCard from \"../../components/Cards/LargeCard/LargeCard.js\";\nimport Page from \"../../components/Page/Page\";\nimport styles from \"../../components/Page/Page.module.css\";\nimport TextEditor from \"../../components/TextEditor/TextEditor\";\nimport { Value } from \"slate\";\nimport DatePicker from \"react-datepicker\";\nimport { HeaderContext } from \"../../contexts/reducers/headerContext\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport axios from \"axios\";\nimport { Card } from \"../../components/Cards/Card\";\nimport { initializeApollo, addApolloState } from \"../../lib/apolloClient\";\nimport { gql, useQuery, useMutation, NetworkStatus } from \"@apollo/client\";\nimport { ARTICLE_QUERY } from \"./index\";\nimport { useRouter } from \"next/router\";\nimport Html from \"slate-html-serializer\";\nimport { getRules } from \"../../components/TextEditor/TextEditor\";\nexport const EDIT_ARTICLE_MUTATION = gql`\n  mutation editArticle(\n    $_id: String!\n    $title: String!\n    $author: String!\n    $date: String\n    $image: String!\n    $content: String!\n  ) {\n    editArticle(\n      _id: $_id\n      title: $title\n      author: $author\n      date: $date\n      image: $image\n      content: $content\n    ) {\n      _id\n      date\n      image\n      title\n      author\n      authorId\n      isApproved\n      content\n      comments {\n        _id\n        authorId\n        author\n        content\n        createdAt\n        updatedAt\n      }\n    }\n  }\n`;\n\n//TO Both Moderators and posters get same message when saving. Needs to change\nconst initialValue = {\n  document: {\n    nodes: [\n      {\n        object: \"block\",\n        type: \"paragraph\",\n        nodes: [\n          {\n            object: \"text\",\n            leaves: [\n              {\n                text: \"Edit text and save to submit for moderator approval...\",\n              },\n            ],\n          },\n        ],\n      },\n    ],\n  },\n};\n\nconst Edit = (props) => {\n  const router = useRouter();\n  const { id } = router.query;\n  const [textEditorValue, setTextEditorValue] = useState(\n    Value.fromJSON(initialValue)\n  );\n\n  const [formData, setFormData] = useState({\n    title: \"To be edited\",\n    author: \"To be edited\",\n    date: new Date(),\n    image:\n      \"data:image/png;base64,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\",\n  });\n  const [image, setImage] = useState(\n    \"data:image/png;base64,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}\"\n  );\n\n  const { loading, error, fetchMore, data, networkStatus, refetch } = useQuery(\n    ARTICLE_QUERY,\n    {\n      variables: { _id: id },\n      notifyOnNetworkStatusChange: true,\n    }\n  );\n\n  const loadingArticle = networkStatus === NetworkStatus.fetchMore;\n  let article;\n  if (loading && !loadingArticle) {\n    article = {};\n  } else {\n    article = {\n      ...data.article,\n      date: JSON.parse(data.article.date),\n      content: data.article.content\n        ? JSON.parse(data.article.content)\n        : initialValue,\n      comments: data.article.comments.map((comment) => ({\n        ...comment,\n        content: JSON.parse(comment.content),\n        createdAt: JSON.parse(comment.createdAt),\n        updatedAt: JSON.parse(comment.updatedAt),\n      })),\n    };\n  }\n  useMemo(\n    () => setTextEditorValue(Value.fromJSON(article.content)),\n    article.content\n  );\n  const [saveEditedArticle, { _ }] = useMutation(EDIT_ARTICLE_MUTATION);\n  const [headerState, headerDispatch] = useContext(HeaderContext);\n  const headerBoxRef = headerState.headerBoxRef;\n  const [toolbarFixed, setToolbarFix] = useState(false);\n  const headlineFormRef = useRef();\n\n  useEffect(() => {\n    const height =\n      headerBoxRef && headerBoxRef.current\n        ? headerBoxRef.current.clientHeight\n        : 380;\n    const fixToolbar = (e) => {\n      if (window.scrollY > 2 * height - 66 + 644) {\n        setToolbarFix(true);\n      } else {\n        setToolbarFix(false);\n      }\n    };\n\n    window.addEventListener(\"scroll\", fixToolbar);\n    return () => {\n      window.removeEventListener(\"scroll\", fixToolbar);\n    };\n  }, [toolbarFixed]);\n\n  useEffect(() => {\n    setFormData({\n      title: article.title,\n      author: article.author,\n      date: new Date(article.date),\n      image: article.image,\n    });\n    setImage(article.image);\n  }, [\n    article.title,\n    article.author,\n    article.author,\n    article.date,\n    article.image,\n  ]);\n\n  useEffect(() => {\n    const keyDownHandler = (e) => {\n      if (e.keyCode === 83 && e.ctrlKey) {\n        e.preventDefault();\n        saveArticle();\n      }\n    };\n\n    document.addEventListener(\"keydown\", keyDownHandler);\n    return () => {\n      document.removeEventListener(\"keydown\", keyDownHandler);\n    };\n  }, [article, textEditorValue]);\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n\n  const saveArticle = () => {\n    saveEditedArticle({\n      variables: {\n        _id: id,\n        title: formData.title,\n        author: formData.author,\n        date: JSON.stringify(article.date),\n        image: image,\n        content: JSON.stringify(textEditorValue.toJSON()),\n      },\n    });\n    // const editedArticle = { ...article, content: textEditorValue.toJSON() };\n\n    // const options = {\n    //   headers: { \"Content-Type\": \"application/json\" },\n    // };\n    // axios\n    //   .post(\"/api/articles/edit\", JSON.stringify(editedArticle), options)\n    //   .then((res) => {\n    //     alert(\"Changes saved and submitted for moderator approval\");\n    //   })\n    //   .catch((err) => {\n    //     if (err.response.status === 401 || err.response.status === 400) {\n    //       alert(err.response.data.error);\n    //     } else if (err.response.status !== 200) {\n    //       throw Error(err);\n    //     }\n    //   });\n  };\n\n  const onTitleChange = (event) => {\n    setFormData({\n      ...formData,\n      title: event.target.value,\n    });\n  };\n\n  const onAuthorChange = (event) => {\n    setFormData({\n      ...formData,\n      author: event.target.value,\n    });\n  };\n\n  const onDateChange = (newDate) => {\n    setFormData({\n      ...formData,\n      date: newDate,\n    });\n  };\n\n  const onImageChange = (event) => {\n    setFormData({\n      ...formData,\n      image: event.target.value,\n    });\n  };\n\n  const isPendingApproval = !article.isApproved;\n\n  const headline = (\n    <div\n      className={styles[\"headline\"]}\n      style={isPendingApproval ? { marginTop: \"36px\" } : { marginTop: \"0px\" }}\n    >\n      <LargeCard\n        title={formData.title}\n        author={formData.author}\n        date={formData.date}\n        isApproved={article.isApproved}\n        contentType={Card.ContentType[\"article-internal\"]}\n        image={image}\n        onClick={() => {}}\n      />\n    </div>\n  );\n\n  const handleSubmit = (event) => {\n    event.preventDefault();\n    setImage(formData.image);\n  };\n\n  const contents = (\n    <div>\n      <form\n        ref={headlineFormRef}\n        onSubmit={handleSubmit}\n        className={styles[\"headline-form\"]}\n      >\n        <div className={styles[\"horizontal\"]}>\n          <label>Title: </label>\n          <input\n            className={styles[\"headline-form-input\"]}\n            type=\"text\"\n            value={formData.title}\n            onChange={onTitleChange}\n          />\n        </div>\n        <div className={styles[\"horizontal-same-line\"]}>\n          <div className={styles[\"horizontal\"]}>\n            <label>Author: </label>\n            <input\n              className={`${styles[\"headline-form-input\"]}`}\n              type=\"text\"\n              value={formData.author}\n              onChange={onAuthorChange}\n            />\n          </div>\n          <div className={styles[\"horizontal\"]}>\n            <label>Date: </label>\n            <DatePicker\n              className={`${styles[\"DatePicker\"]}`}\n              selected={formData.date}\n              onChange={onDateChange}\n            />\n          </div>\n        </div>\n        <div className={styles[\"horizontal\"]}>\n          <label>Image: </label>\n          <input\n            className={styles[\"headline-form-input\"]}\n            type=\"text\"\n            value={formData.image}\n            onChange={onImageChange}\n          />\n        </div>\n        <input\n          type=\"submit\"\n          value=\"Change Image\"\n          className={styles[\"submit-button\"]}\n        />\n      </form>\n      <TextEditor\n        value={textEditorValue}\n        setValue={setTextEditorValue}\n        onSave={saveArticle}\n        toolbarFixed={toolbarFixed}\n        styles={styles}\n      />\n    </div>\n  );\n\n  return (\n    <Page sidebarFixTopOffset={0} headline={headline} mainPane={contents} />\n  );\n};\n\nexport async function getServerSideProps({ query }) {\n  const apolloClient = initializeApollo();\n\n  await apolloClient.query({\n    query: ARTICLE_QUERY,\n    variables: { _id: query.id },\n  });\n\n  return addApolloState(apolloClient, {\n    props: {},\n  });\n}\n\nexport default Edit;\n"]},"metadata":{},"sourceType":"module"}