{"ast":null,"code":"const mongoose = require(\"mongoose\");\n\nconst fetch = require(\"node-fetch\");\n\nvar parser = require(\"xml2json\");\n\nconst bcrypt = require(\"bcryptjs\");\n\nconst jwt = require(\"jsonwebtoken\");\n\nrequire(\"dotenv/config\");\n\nconst sgMail = require(\"@sendgrid/mail\");\n\nsgMail.setApiKey(process.env.SENDGRID_API_KEY);\n\nconst {\n  loginValidation,\n  registerValidation,\n  resetPasswordValidation,\n  messageValidation\n} = require(\"../validation/validation\");\n\nlet YoutubeLink;\n\ntry {\n  YoutubeLink = mongoose.model(\"YoutubeLinks\");\n} catch {\n  YoutubeLink = require(\"../models/YoutubeLinks\");\n}\n\nlet User;\n\ntry {\n  User = mongoose.model(\"Users\");\n} catch {\n  User = require(\"../models/Users\");\n}\n\nlet Article;\n\ntry {\n  Article = mongoose.model(\"Articles\");\n} catch {\n  Article = require(\"../models/Articles\");\n}\n\nlet Comment;\n\ntry {\n  Comment = mongoose.model(\"Comments\");\n} catch {\n  Comment = require(\"../models/Comments\");\n}\n\nlet Message;\n\ntry {\n  Message = mongoose.model(\"Messages\");\n} catch {\n  Message = require(\"../models/Messages\");\n}\n\nexport const resolvers = {\n  Query: {\n    youtubeLinks: async () => await YoutubeLink.find({}).sort(\"-date\"),\n    podcasts: async () => await fetch(`https://anchor.fm/s/333e122c/podcast/rss`).then(response => response.text()).then(data => {\n      let json = JSON.parse(parser.toJson(data, {\n        reversible: false\n      }));\n      return json.rss.channel.item.map(element => {\n        const text = element[\"description\"].replace(/<[^>]+>/g, \"\").replace(/&nbsp;/, \"\");\n        return {\n          title: element[\"title\"],\n          by: element[\"dc:creator\"],\n          link: element[\"enclosure\"][\"url\"],\n          date: element[\"pubDate\"],\n          image: element[\"itunes:image\"][\"href\"],\n          description: text.substring(0, text.indexOf(\"---\"))\n        };\n      });\n    }),\n    isLoggedIn: async (parent, args, ctx) => {\n      const {\n        authData\n      } = ctx;\n\n      if (!authData) {\n        throw Error(\"Please login to proceed\");\n      }\n\n      try {\n        const user = await User.findById(authData._id);\n        return user;\n      } catch (err) {\n        throw Error(err.message);\n      }\n    },\n    login: async (parent, args, ctx) => {\n      const {\n        error\n      } = loginValidation(args);\n\n      if (error) {\n        const toReturn = error.details[0].message.replace('\"email\"', \"Email\").replace('\"password\"', \"Password\");\n        throw Error(toReturn);\n      }\n\n      const {\n        cookie\n      } = ctx;\n      const {\n        email,\n        password\n      } = args;\n      const user = await User.findOne({\n        email: email\n      });\n      if (!user) throw Error(\"The email or password is incorrect\");\n      const validPass = await bcrypt.compare(password, user.password);\n      if (!validPass) throw Error(\"The email or password is incorrect\");\n      const token = jwt.sign({\n        _id: user._id,\n        tokenCreated: new Date()\n      }, process.env.TOKEN_SECRET);\n      cookie(\"token\", token, {\n        path: \"/\",\n        httpOnly: true,\n        sameSite: \"strict\"\n      });\n      return {\n        token: token\n      };\n    },\n    logout: (parent, args, ctx) => {\n      try {\n        const {\n          cookie\n        } = ctx;\n        cookie(\"token\", \"deleted\", {\n          path: \"/\",\n          httpOnly: true,\n          maxAge: 0,\n          sameSite: \"strict\"\n        });\n      } catch {\n        return false;\n      }\n\n      return true;\n    },\n    forgotPassword: async (parent, args, ctx) => {\n      const {\n        error\n      } = resetPasswordValidation(args);\n\n      if (error) {\n        const toReturn = error.details[0].message.replace('\"email\"', \"Email\");\n        throw Error(toReturn);\n      }\n\n      await User.findOne({\n        email: args.email\n      }, async (err, user) => {\n        if (err || !user) {\n          if (err) {\n            throw Error(err.message);\n          } else if (!user) {\n            throw Error(\"Cannot find account matching given email\");\n          }\n        } else {\n          const secret = `${user.password}-${user.updatedAt}`;\n          const token = jwt.sign({\n            id: user._id,\n            email: user.email\n          }, secret);\n          const passwordResetLink = false ? `www.thefalseninepodcast.com/resetpassword?id=${user._id}&token=${token}` : `localhost:3000/resetpassword?id=${user._id}&token=${token}`;\n          const msg = {\n            from: `The False 9 Podcast <${process.env.EMAIL}>`,\n            to: user.email,\n            subject: \"Password Reset Link\",\n            text: `Password Reset Link: ${passwordResetLink}`\n          };\n          sgMail.send(msg).then(() => {\n            console.log(\"Email sent\");\n          }).catch(error => {\n            console.error(error);\n            throw Error(error.message);\n          });\n        }\n      });\n      return true;\n    },\n    articles: async (parent, args, ctx) => {\n      let user;\n      const {\n        authData\n      } = ctx;\n\n      if (authData) {\n        try {\n          user = await User.findById(authData._id);\n        } catch (err) {\n          console.log(err);\n        }\n      }\n\n      let query;\n\n      if (user) {\n        if (user.isModerator) {\n          query = Article.find({}).sort(\"-date\");\n        } else {\n          query = Article.find({\n            $or: [{\n              isApproved: true\n            }, {\n              authorId: user._id\n            }]\n          }).sort(\"-date\");\n        }\n      } else {\n        query = Article.find({}).where(\"isApproved\").equals(true).sort(\"-date\");\n      }\n\n      try {\n        const data = await query.exec();\n        const toReturn = data.map(article => ({\n          _id: article._id,\n          title: article.title,\n          author: article.author,\n          authorId: article.authorId,\n          date: JSON.stringify(article.date),\n          image: article.image,\n          isApproved: article.isApproved,\n          content: JSON.stringify(article.content),\n          comments: article.comments.map(comment => ({\n            _id: comment._id,\n            authorId: comment.authorID,\n            author: comment.author,\n            content: JSON.stringify(comment.content),\n            createdAt: comment.createdAt,\n            updatedAt: comment.updatedAt\n          }))\n        }));\n        return toReturn;\n      } catch (err) {\n        throw Error(err.message);\n      }\n    },\n    article: async (parent, args, ctx) => {\n      const id = args._id;\n      let article;\n\n      try {\n        article = await Article.findById(id);\n      } catch (err) {\n        throw Error(err);\n      }\n\n      return {\n        _id: article._id,\n        title: article.title,\n        author: article.author,\n        authorId: article.authorId,\n        date: JSON.stringify(article.date),\n        image: article.image,\n        isApproved: article.isApproved,\n        content: JSON.stringify(article.content),\n        comments: article.comments.map(comment => ({\n          _id: comment._id,\n          authorId: comment.authorID,\n          author: comment.author,\n          content: JSON.stringify(comment.content),\n          createdAt: comment.createdAt,\n          updatedAt: comment.updatedAt\n        }))\n      };\n    },\n    messages: async () => {\n      const query = Message.find({}).sort(\"-createdAt\");\n      let messages;\n\n      try {\n        messages = await query.exec();\n      } catch (err) {\n        throw Error(err);\n      }\n\n      return messages.map(message => ({\n        _id: message._id,\n        firstName: message.firstName,\n        lastName: message.lastName,\n        email: message.email,\n        subject: message.subject,\n        createdAt: message.createdAt,\n        updatedAt: message.updatedAt,\n        content: JSON.stringify(message.content)\n      }));\n    },\n    message: async (parent, args, ctx) => {\n      const _id = args._id;\n      let message;\n\n      try {\n        message = await Message.findById(_id);\n      } catch (err) {\n        throw Error(err);\n      }\n\n      return {\n        _id: message._id,\n        firstName: message.firstName,\n        lastName: message.lastName,\n        email: message.email,\n        subject: message.subject,\n        createdAt: message.createdAt,\n        updatedAt: message.updatedAt,\n        content: JSON.stringify(message.content)\n      };\n    }\n  },\n  Mutation: {\n    register: async (parent, args, ctx) => {\n      const {\n        error\n      } = registerValidation(args);\n\n      if (error) {\n        const toReturn = error.details[0].message.replace('\"firstName\"', \"First Name\").replace('\"lastName\"', \"Last Name\").replace('\"email\"', \"Email\").replace('\"password\"', \"Password\");\n        throw Error(toReturn);\n      }\n\n      const emailExists = await User.findOne({\n        email: args.email\n      });\n      if (emailExists) throw Error(\"Email already exists\");\n      const salt = await bcrypt.genSalt(10);\n      const hashPassword = await bcrypt.hash(args.password, salt);\n      const user = new User({\n        firstName: args.firstName,\n        lastName: args.lastName,\n        email: args.email,\n        password: hashPassword,\n        isModerator: false,\n        isSubscribed: args.isSubscribed || false\n      });\n\n      try {\n        const savedUser = await user.save();\n        return savedUser;\n      } catch (err) {\n        throw Error(err.message);\n      }\n    },\n    subscribe: async (parent, args, ctx) => {\n      const {\n        authData\n      } = ctx;\n\n      if (!authData) {\n        throw Error(\"Please login to proceed\");\n      }\n\n      try {\n        const user = await User.findById(authData._id);\n        user.isSubscribed = args.isSubscribed;\n        return await user.save();\n      } catch (err) {\n        throw Error(err.message);\n      }\n    },\n    resetPassword: async (parent, args, ctx) => {\n      let savedUser;\n\n      try {\n        const user = await User.findById(args._id);\n        const secret = `${user.password}-${user.updatedAt}`;\n        const verified = jwt.verify(args.token, secret);\n\n        if (verified) {\n          const salt = await bcrypt.genSalt(10);\n          const hashPassword = await bcrypt.hash(args.password, salt);\n          user.password = hashPassword;\n          savedUser = await user.save();\n        }\n      } catch (err) {\n        throw Error(err.message);\n      }\n\n      return savedUser;\n    },\n    createArticle: async (parent, args, ctx) => {\n      const {\n        authData\n      } = ctx;\n\n      if (!authData) {\n        throw Error(\"Please login to proceed\");\n      }\n\n      let savedArticle;\n\n      try {\n        const user = await User.findById(authData._id);\n\n        if (user) {\n          const article = new Article({\n            title: \"To be edited\",\n            author: `${user.firstName} ${user.lastName}`,\n            authorId: user._id,\n            date: new Date(),\n            image: \"data:image/png;base64,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\",\n            content: {},\n            isApproved: user.isModerator\n          });\n          savedArticle = await article.save();\n        }\n      } catch (err) {\n        throw Error(err.message);\n      }\n\n      return {\n        _id: savedArticle._id,\n        title: savedArticle.title,\n        author: savedArticle.author,\n        authorId: savedArticle.authorId,\n        date: savedArticle.date,\n        image: savedArticle.image,\n        isApproved: savedArticle.isApproved,\n        content: JSON.stringify(savedArticle.content),\n        comments: savedArticle.comments.map(comment => ({\n          _id: comment._id,\n          authorId: comment.authorID,\n          author: comment.author,\n          content: JSON.stringify(comment.content),\n          createdAt: comment.createdAt,\n          updatedAt: comment.updatedAt\n        }))\n      };\n    },\n    editArticle: async (parent, args, ctx) => {\n      const {\n        authData\n      } = ctx;\n\n      if (!authData) {\n        throw Error(\"Please login to proceed\");\n      }\n\n      let editedArticle;\n\n      try {\n        const user = await User.findById(authData._id);\n        const article = await Article.findById(args._id);\n\n        if (!user || !user.isModerator && !user._id.equals(article.authorId)) {\n          throw Error(\"User not authorized to edit file\");\n        } else {\n          article.title = args.title || article.title;\n          article.author = args.author || article.author;\n          article.date = args.date || article.date;\n          article.image = args.image || article.image;\n          article.content = JSON.stringify(args.content) || article.content;\n          article.isApproved = user.isModerator;\n          editedArticle = await article.save();\n        }\n      } catch (err) {\n        throw Error(err.message);\n      }\n\n      return {\n        _id: editedArticle._id,\n        title: editedArticle.title,\n        author: editedArticle.author,\n        authorId: editedArticle.authorId,\n        date: editedArticle.date,\n        image: editedArticle.image,\n        isApproved: editArticle.isApproved,\n        content: JSON.stringify(editedArticle.content),\n        comments: editedArticle.comments.map(comment => ({\n          _id: comment._id,\n          authorId: comment.authorID,\n          author: comment.author,\n          content: JSON.stringify(comment.content),\n          createdAt: comment.createdAt,\n          updatedAt: comment.updatedAt\n        }))\n      };\n    },\n    postComment: async (parent, args, ctx) => {\n      const {\n        authData\n      } = ctx;\n\n      if (!authData) {\n        throw Error(\"Please login to proceed\");\n      }\n\n      let editedArticle;\n\n      try {\n        const article = await Article.findById(args._id);\n        const user = await User.findById(authData._id);\n        const comment = new Comment({\n          authorID: user._id,\n          author: `${user.firstName} ${user.lastName}`,\n          content: JSON.parse(args.content)\n        });\n        article.comments.unshift(comment);\n        editedArticle = await article.save();\n      } catch (err) {\n        throw Error(err.message);\n      }\n\n      return {\n        _id: editedArticle._id,\n        title: editedArticle.title,\n        author: editedArticle.author,\n        authorId: editedArticle.authorId,\n        date: editedArticle.date,\n        image: editedArticle.image,\n        isApproved: editArticle.isApproved,\n        content: JSON.stringify(editedArticle.content),\n        comments: editedArticle.comments.map(comment => ({\n          _id: comment._id,\n          authorId: comment.authorID,\n          author: comment.author,\n          content: JSON.stringify(comment.content),\n          createdAt: comment.createdAt,\n          updatedAt: comment.updatedAt\n        }))\n      };\n    },\n    createMessage: async (parent, args, ctx) => {\n      const {\n        error\n      } = messageValidation(args);\n\n      if (error) {\n        const toReturn = error.details[0].message.replace('\"firstName\"', \"First Name\").replace('\"lastName\"', \"Last Name\").replace('\"email\"', \"Email\").replace('\"subject\"', \"Subject\");\n        throw Error(toReturn);\n      }\n\n      let savedMessage;\n\n      try {\n        const message = new Message({\n          firstName: args.firstName,\n          lastName: args.lastName,\n          email: args.email,\n          subject: args.subject,\n          content: args.content ? JSON.parse(args.content) : {}\n        });\n        savedMessage = await message.save();\n      } catch (err) {\n        throw Error(err.message);\n      }\n\n      return {\n        _id: savedMessage._id,\n        firstName: savedMessage.firstName,\n        lastName: savedMessage.lastName,\n        email: savedMessage.email,\n        subject: savedMessage.subject,\n        createdAt: savedMessage.createdAt,\n        updatedAt: savedMessage.updatedAt,\n        content: JSON.stringify(savedMessage.content)\n      };\n    }\n  }\n};","map":{"version":3,"sources":["/home/sajalrs/ReactProgramming/article_podcast_website/pages/api/graphql/resolvers.js"],"names":["mongoose","require","fetch","parser","bcrypt","jwt","sgMail","setApiKey","process","env","SENDGRID_API_KEY","loginValidation","registerValidation","resetPasswordValidation","messageValidation","YoutubeLink","model","User","Article","Comment","Message","resolvers","Query","youtubeLinks","find","sort","podcasts","then","response","text","data","json","JSON","parse","toJson","reversible","rss","channel","item","map","element","replace","title","by","link","date","image","description","substring","indexOf","isLoggedIn","parent","args","ctx","authData","Error","user","findById","_id","err","message","login","error","toReturn","details","cookie","email","password","findOne","validPass","compare","token","sign","tokenCreated","Date","TOKEN_SECRET","path","httpOnly","sameSite","logout","maxAge","forgotPassword","secret","updatedAt","id","passwordResetLink","msg","from","EMAIL","to","subject","send","console","log","catch","articles","query","isModerator","$or","isApproved","authorId","where","equals","exec","article","author","stringify","content","comments","comment","authorID","createdAt","messages","firstName","lastName","Mutation","register","emailExists","salt","genSalt","hashPassword","hash","isSubscribed","savedUser","save","subscribe","resetPassword","verified","verify","createArticle","savedArticle","editArticle","editedArticle","postComment","unshift","createMessage","savedMessage"],"mappings":"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","sourcesContent":["const mongoose = require(\"mongoose\");\nconst fetch = require(\"node-fetch\");\nvar parser = require(\"xml2json\");\nconst bcrypt = require(\"bcryptjs\");\nconst jwt = require(\"jsonwebtoken\");\nrequire(\"dotenv/config\");\nconst sgMail = require(\"@sendgrid/mail\");\nsgMail.setApiKey(process.env.SENDGRID_API_KEY);\nconst {\n  loginValidation,\n  registerValidation,\n  resetPasswordValidation,\n  messageValidation,\n} = require(\"../validation/validation\");\n\nlet YoutubeLink;\ntry {\n  YoutubeLink = mongoose.model(\"YoutubeLinks\");\n} catch {\n  YoutubeLink = require(\"../models/YoutubeLinks\");\n}\n\nlet User;\ntry {\n  User = mongoose.model(\"Users\");\n} catch {\n  User = require(\"../models/Users\");\n}\n\nlet Article;\ntry {\n  Article = mongoose.model(\"Articles\");\n} catch {\n  Article = require(\"../models/Articles\");\n}\n\nlet Comment;\ntry {\n  Comment = mongoose.model(\"Comments\");\n} catch {\n  Comment = require(\"../models/Comments\");\n}\n\nlet Message;\ntry {\n  Message = mongoose.model(\"Messages\");\n} catch {\n  Message = require(\"../models/Messages\");\n}\n\nexport const resolvers = {\n  Query: {\n    youtubeLinks: async () => await YoutubeLink.find({}).sort(\"-date\"),\n\n    podcasts: async () =>\n      await fetch(`https://anchor.fm/s/333e122c/podcast/rss`)\n        .then((response) => response.text())\n        .then((data) => {\n          let json = JSON.parse(parser.toJson(data, { reversible: false }));\n          return json.rss.channel.item.map((element) => {\n            const text = element[\"description\"]\n              .replace(/<[^>]+>/g, \"\")\n              .replace(/&nbsp;/, \"\");\n            return {\n              title: element[\"title\"],\n              by: element[\"dc:creator\"],\n              link: element[\"enclosure\"][\"url\"],\n              date: element[\"pubDate\"],\n              image: element[\"itunes:image\"][\"href\"],\n              description: text.substring(0, text.indexOf(\"---\")),\n            };\n          });\n        }),\n\n    isLoggedIn: async (parent, args, ctx) => {\n      const { authData } = ctx;\n      if (!authData) {\n        throw Error(\"Please login to proceed\");\n      }\n\n      try {\n        const user = await User.findById(authData._id);\n        return user;\n      } catch (err) {\n        throw Error(err.message);\n      }\n    },\n\n    login: async (parent, args, ctx) => {\n      const { error } = loginValidation(args);\n      if (error) {\n        const toReturn = error.details[0].message\n          .replace('\"email\"', \"Email\")\n          .replace('\"password\"', \"Password\");\n        throw Error(toReturn);\n      }\n      const { cookie } = ctx;\n      const { email, password } = args;\n      const user = await User.findOne({ email: email });\n\n      if (!user) throw Error(\"The email or password is incorrect\");\n\n      const validPass = await bcrypt.compare(password, user.password);\n      if (!validPass) throw Error(\"The email or password is incorrect\");\n\n      const token = jwt.sign(\n        { _id: user._id, tokenCreated: new Date() },\n        process.env.TOKEN_SECRET\n      );\n      cookie(\"token\", token, {\n        path: \"/\",\n        httpOnly: true,\n        sameSite: \"strict\",\n      });\n      return { token: token };\n    },\n\n    logout: (parent, args, ctx) => {\n      try {\n        const { cookie } = ctx;\n        cookie(\"token\", \"deleted\", {\n          path: \"/\",\n          httpOnly: true,\n          maxAge: 0,\n          sameSite: \"strict\",\n        });\n      } catch {\n        return false;\n      }\n      return true;\n    },\n\n    forgotPassword: async (parent, args, ctx) => {\n      const { error } = resetPasswordValidation(args);\n      if (error) {\n        const toReturn = error.details[0].message.replace('\"email\"', \"Email\");\n        throw Error(toReturn);\n      }\n\n      await User.findOne({ email: args.email }, async (err, user) => {\n        if (err || !user) {\n          if (err) {\n            throw Error(err.message);\n          } else if (!user) {\n            throw Error(\"Cannot find account matching given email\");\n          }\n        } else {\n          const secret = `${user.password}-${user.updatedAt}`;\n          const token = jwt.sign({ id: user._id, email: user.email }, secret);\n          const passwordResetLink =\n            process.env.NODE_ENV === \"production\"\n              ? `www.thefalseninepodcast.com/resetpassword?id=${user._id}&token=${token}`\n              : `localhost:3000/resetpassword?id=${user._id}&token=${token}`;\n\n          const msg = {\n            from: `The False 9 Podcast <${process.env.EMAIL}>`,\n            to: user.email,\n            subject: \"Password Reset Link\",\n            text: `Password Reset Link: ${passwordResetLink}`,\n          };\n\n          sgMail\n            .send(msg)\n            .then(() => {\n              console.log(\"Email sent\");\n            })\n            .catch((error) => {\n              console.error(error);\n              throw Error(error.message);\n            });\n        }\n      });\n      return true;\n    },\n\n    articles: async (parent, args, ctx) => {\n      let user;\n      const { authData } = ctx;\n      if (authData) {\n        try {\n          user = await User.findById(authData._id);\n        } catch (err) {\n          console.log(err);\n        }\n      }\n\n      let query;\n      if (user) {\n        if (user.isModerator) {\n          query = Article.find({}).sort(\"-date\");\n        } else {\n          query = Article.find({\n            $or: [{ isApproved: true }, { authorId: user._id }],\n          }).sort(\"-date\");\n        }\n      } else {\n        query = Article.find({}).where(\"isApproved\").equals(true).sort(\"-date\");\n      }\n      try {\n        const data = await query.exec();\n        const toReturn = data.map((article) => ({\n          _id: article._id,\n          title: article.title,\n          author: article.author,\n          authorId: article.authorId,\n          date: JSON.stringify(article.date),\n          image: article.image,\n          isApproved: article.isApproved,\n          content: JSON.stringify(article.content),\n          comments: article.comments.map((comment) => ({\n            _id: comment._id,\n            authorId: comment.authorID,\n            author: comment.author,\n            content: JSON.stringify(comment.content),\n            createdAt: comment.createdAt,\n            updatedAt: comment.updatedAt,\n          })),\n        }));\n        return toReturn;\n      } catch (err) {\n        throw Error(err.message);\n      }\n    },\n\n    article: async (parent, args, ctx) => {\n      const id = args._id;\n      let article;\n      try {\n        article = await Article.findById(id);\n      } catch (err) {\n        throw Error(err);\n      }\n      return {\n        _id: article._id,\n        title: article.title,\n        author: article.author,\n        authorId: article.authorId,\n        date: JSON.stringify(article.date),\n        image: article.image,\n        isApproved: article.isApproved,\n        content: JSON.stringify(article.content),\n        comments: article.comments.map((comment) => ({\n          _id: comment._id,\n          authorId: comment.authorID,\n          author: comment.author,\n          content: JSON.stringify(comment.content),\n          createdAt: comment.createdAt,\n          updatedAt: comment.updatedAt,\n        })),\n      };\n    },\n\n    messages: async () => {\n      const query = Message.find({}).sort(\"-createdAt\");\n      let messages;\n      try {\n        messages = await query.exec();\n      } catch (err) {\n        throw Error(err);\n      }\n\n      return messages.map((message) => ({\n        _id: message._id,\n        firstName: message.firstName,\n        lastName: message.lastName,\n        email: message.email,\n        subject: message.subject,\n        createdAt: message.createdAt,\n        updatedAt: message.updatedAt,\n        content: JSON.stringify(message.content),\n      }))\n    },\n\n    message: async (parent, args, ctx) => {\n      const _id = args._id;\n      let message;\n      try {\n        message =  await Message.findById(_id)\n      } catch (err) {\n        throw Error(err);\n      }\n\n      return {\n        _id: message._id,\n        firstName: message.firstName,\n        lastName: message.lastName,\n        email: message.email,\n        subject: message.subject,\n        createdAt: message.createdAt,\n        updatedAt: message.updatedAt,\n        content: JSON.stringify(message.content),\n      }\n    },\n  },\n\n  Mutation: {\n    register: async (parent, args, ctx) => {\n      const { error } = registerValidation(args);\n      if (error) {\n        const toReturn = error.details[0].message\n          .replace('\"firstName\"', \"First Name\")\n          .replace('\"lastName\"', \"Last Name\")\n          .replace('\"email\"', \"Email\")\n          .replace('\"password\"', \"Password\");\n        throw Error(toReturn);\n      }\n\n      const emailExists = await User.findOne({ email: args.email });\n\n      if (emailExists) throw Error(\"Email already exists\");\n\n      const salt = await bcrypt.genSalt(10);\n      const hashPassword = await bcrypt.hash(args.password, salt);\n\n      const user = new User({\n        firstName: args.firstName,\n        lastName: args.lastName,\n        email: args.email,\n        password: hashPassword,\n        isModerator: false,\n        isSubscribed: args.isSubscribed || false,\n      });\n\n      try {\n        const savedUser = await user.save();\n        return savedUser;\n      } catch (err) {\n        throw Error(err.message);\n      }\n    },\n\n    subscribe: async (parent, args, ctx) => {\n      const { authData } = ctx;\n      if (!authData) {\n        throw Error(\"Please login to proceed\");\n      }\n\n      try {\n        const user = await User.findById(authData._id);\n        user.isSubscribed = args.isSubscribed;\n        return await user.save();\n      } catch (err) {\n        throw Error(err.message);\n      }\n    },\n\n    resetPassword: async (parent, args, ctx) => {\n      let savedUser;\n      try {\n        const user = await User.findById(args._id);\n        const secret = `${user.password}-${user.updatedAt}`;\n        const verified = jwt.verify(args.token, secret);\n        if (verified) {\n          const salt = await bcrypt.genSalt(10);\n          const hashPassword = await bcrypt.hash(args.password, salt);\n          user.password = hashPassword;\n          savedUser = await user.save();\n        }\n      } catch (err) {\n        throw Error(err.message);\n      }\n      return savedUser;\n    },\n\n    createArticle: async (parent, args, ctx) => {\n      const { authData } = ctx;\n      if (!authData) {\n        throw Error(\"Please login to proceed\");\n      }\n      let savedArticle;\n      try {\n        const user = await User.findById(authData._id);\n        if (user) {\n          const article = new Article({\n            title: \"To be edited\",\n            author: `${user.firstName} ${user.lastName}`,\n            authorId: user._id,\n            date: new Date(),\n            image:\n              \"data:image/png;base64,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\",\n            content: {},\n            isApproved: user.isModerator,\n          });\n\n          savedArticle = await article.save();\n        }\n      } catch (err) {\n        throw Error(err.message);\n      }\n      return {\n        _id: savedArticle._id,\n        title: savedArticle.title,\n        author: savedArticle.author,\n        authorId: savedArticle.authorId,\n        date: savedArticle.date,\n        image: savedArticle.image,\n        isApproved: savedArticle.isApproved,\n        content: JSON.stringify(savedArticle.content),\n        comments: savedArticle.comments.map((comment) => ({\n          _id: comment._id,\n          authorId: comment.authorID,\n          author: comment.author,\n          content: JSON.stringify(comment.content),\n          createdAt: comment.createdAt,\n          updatedAt: comment.updatedAt,\n        })),\n      };\n    },\n\n    editArticle: async (parent, args, ctx) => {\n      const { authData } = ctx;\n      if (!authData) {\n        throw Error(\"Please login to proceed\");\n      }\n      let editedArticle;\n      try {\n        const user = await User.findById(authData._id);\n        const article = await Article.findById(args._id);\n        if (\n          !user ||\n          (!user.isModerator && !user._id.equals(article.authorId))\n        ) {\n          throw Error(\"User not authorized to edit file\");\n        } else {\n          article.title = args.title || article.title;\n          article.author = args.author || article.author;\n          article.date = args.date || article.date;\n          article.image = args.image || article.image;\n          article.content = JSON.stringify(args.content) || article.content;\n          article.isApproved = user.isModerator;\n          editedArticle = await article.save();\n        }\n      } catch (err) {\n        throw Error(err.message);\n      }\n      return {\n        _id: editedArticle._id,\n        title: editedArticle.title,\n        author: editedArticle.author,\n        authorId: editedArticle.authorId,\n        date: editedArticle.date,\n        image: editedArticle.image,\n        isApproved: editArticle.isApproved,\n        content: JSON.stringify(editedArticle.content),\n        comments: editedArticle.comments.map((comment) => ({\n          _id: comment._id,\n          authorId: comment.authorID,\n          author: comment.author,\n          content: JSON.stringify(comment.content),\n          createdAt: comment.createdAt,\n          updatedAt: comment.updatedAt,\n        })),\n      };\n    },\n\n    postComment: async (parent, args, ctx) => {\n      const { authData } = ctx;\n      if (!authData) {\n        throw Error(\"Please login to proceed\");\n      }\n      let editedArticle;\n      try {\n        const article = await Article.findById(args._id);\n        const user = await User.findById(authData._id);\n        const comment = new Comment({\n          authorID: user._id,\n          author: `${user.firstName} ${user.lastName}`,\n          content: JSON.parse(args.content),\n        });\n        article.comments.unshift(comment);\n        editedArticle = await article.save();\n      } catch (err) {\n        throw Error(err.message);\n      }\n      return {\n        _id: editedArticle._id,\n        title: editedArticle.title,\n        author: editedArticle.author,\n        authorId: editedArticle.authorId,\n        date: editedArticle.date,\n        image: editedArticle.image,\n        isApproved: editArticle.isApproved,\n        content: JSON.stringify(editedArticle.content),\n        comments: editedArticle.comments.map((comment) => ({\n          _id: comment._id,\n          authorId: comment.authorID,\n          author: comment.author,\n          content: JSON.stringify(comment.content),\n          createdAt: comment.createdAt,\n          updatedAt: comment.updatedAt,\n        })),\n      };\n    },\n\n    createMessage: async (parent, args, ctx) => {\n      const { error } = messageValidation(args);\n      if (error) {\n        const toReturn = error.details[0].message\n          .replace('\"firstName\"', \"First Name\")\n          .replace('\"lastName\"', \"Last Name\")\n          .replace('\"email\"', \"Email\")\n          .replace('\"subject\"', \"Subject\");\n        throw Error(toReturn);\n      }\n\n      let savedMessage;\n      try {\n        const message = new Message({\n          firstName: args.firstName,\n          lastName: args.lastName,\n          email: args.email,\n          subject: args.subject,\n          content: args.content? JSON.parse(args.content) : {},\n        });\n\n        savedMessage = await message.save();\n      } catch (err) {\n        throw Error(err.message);\n      }\n      return {\n        _id: savedMessage._id,\n        firstName: savedMessage.firstName,\n        lastName: savedMessage.lastName,\n        email: savedMessage.email,\n        subject: savedMessage.subject,\n        createdAt: savedMessage.createdAt,\n        updatedAt: savedMessage.updatedAt,\n        content: JSON.stringify(savedMessage.content),\n      };\n    },\n  },\n};\n"]},"metadata":{},"sourceType":"module"}