{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect, useRef, useContext } from \"react\";\nimport LargeCard from \"../../components/Cards/LargeCard/LargeCard.js\";\nimport Page from \"../../components/Page/Page\";\nimport styles from \"../../components/Page/Page.module.css\";\nimport TextEditor from \"../../components/TextEditor/TextEditor\";\nimport { Value } from \"slate\";\nimport DatePicker from \"react-datepicker\";\nimport { HeaderContext } from \"../../contexts/reducers/headerContext\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport axios from \"axios\";\nimport { Card } from \"../../components/Cards/Card\";\nconst initialValue = {\n  document: {\n    nodes: [{\n      object: \"block\",\n      type: \"paragraph\",\n      nodes: [{\n        object: \"text\",\n        leaves: [{\n          text: \"Edit text and save to submit for moderator approval...\"\n        }]\n      }]\n    }]\n  }\n};\n\nconst Edit = props => {\n  const {\n    0: textEditorValue,\n    1: setTextEditorValue\n  } = useState(Value.fromJSON(initialValue));\n  const {\n    0: formData,\n    1: setFormData\n  } = useState({\n    title: \"To be edited\",\n    author: \"To be edited\",\n    date: new Date(),\n    image: \"data:image/png;base64,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\"\n  });\n  const {\n    0: article,\n    1: setArticle\n  } = useState(props.article);\n  const {\n    0: headerState,\n    1: headerDispatch\n  } = useContext(HeaderContext);\n  const headerBoxRef = headerState.headerBoxRef;\n  const {\n    0: toolbarFixed,\n    1: setToolbarFix\n  } = useState(false);\n  const headlineFormRef = useRef();\n  useEffect(() => {\n    if (article.content) setTextEditorValue(Value.fromJSON(article.content));\n  }, [article.content]);\n  useEffect(() => {\n    const height = headerBoxRef && headerBoxRef.current ? headerBoxRef.current.clientHeight : 380;\n\n    const fixToolbar = e => {\n      if (window.scrollY > 2 * height - 66 + 644) {\n        setToolbarFix(true);\n      } else {\n        setToolbarFix(false);\n      }\n    };\n\n    window.addEventListener(\"scroll\", fixToolbar);\n    return () => {\n      window.removeEventListener(\"scroll\", fixToolbar);\n    };\n  }, [toolbarFixed]);\n  useEffect(() => {\n    setFormData({\n      title: article.title,\n      author: article.author,\n      date: new Date(article.date),\n      image: article.image\n    });\n  }, [article.title, article.author, article.author, article.date, article.image]);\n  useEffect(() => {\n    const keyDownHandler = e => {\n      if (e.keyCode === 83 && e.ctrlKey) {\n        e.preventDefault();\n        saveArticle();\n      }\n    };\n\n    document.addEventListener(\"keydown\", keyDownHandler);\n    return () => {\n      document.removeEventListener(\"keydown\", keyDownHandler);\n    };\n  }, [article, textEditorValue]);\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n\n  const saveArticle = () => {\n    const editedArticle = _objectSpread(_objectSpread({}, article), {}, {\n      content: textEditorValue.toJSON()\n    });\n\n    const options = {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n    axios.post(\"/api/articles/edit\", JSON.stringify(editedArticle), options).then(res => {\n      alert(\"Changes saved and submitted for moderator approval\");\n    }).catch(err => {\n      if (err.response.status === 401 || err.response.status === 400) {\n        alert(err.response.data.error);\n      } else if (err.response.status !== 200) {\n        throw Error(err);\n      }\n    });\n  };\n\n  const handleSubmit = event => {\n    event.preventDefault();\n    setArticle(_objectSpread(_objectSpread({}, article), {}, {\n      title: formData.title,\n      author: formData.author,\n      date: formData.date,\n      image: formData.image\n    })); // console.log(article);\n    // }\n  };\n\n  const onTitleChange = event => {\n    setFormData(_objectSpread(_objectSpread({}, formData), {}, {\n      title: event.target.value\n    }));\n  };\n\n  const onAuthorChange = event => {\n    setFormData(_objectSpread(_objectSpread({}, formData), {}, {\n      author: event.target.value\n    }));\n  };\n\n  const onDateChange = newDate => {\n    setFormData(_objectSpread(_objectSpread({}, formData), {}, {\n      date: newDate\n    }));\n  };\n\n  const onImageChange = event => {\n    setFormData(_objectSpread(_objectSpread({}, formData), {}, {\n      image: event.target.value\n    }));\n  };\n\n  const isPendingApproval = !article.isApproved;\n\n  const headline = __jsx(\"div\", {\n    className: styles[\"headline\"],\n    style: isPendingApproval ? {\n      marginTop: \"36px\"\n    } : {\n      marginTop: \"0px\"\n    }\n  }, __jsx(LargeCard, {\n    title: article.title,\n    author: article.author,\n    date: article.date,\n    isApproved: article.isApproved,\n    contentType: Card.ContentType[\"article-internal\"],\n    image: article.image,\n    onClick: () => {}\n  }));\n\n  const contents = __jsx(\"div\", null, __jsx(\"form\", {\n    ref: headlineFormRef,\n    onSubmit: handleSubmit,\n    className: styles[\"headline-form\"]\n  }, __jsx(\"div\", {\n    className: styles[\"horizontal\"]\n  }, __jsx(\"label\", null, \"Title: \"), __jsx(\"input\", {\n    className: styles[\"headline-form-input\"],\n    type: \"text\",\n    value: formData.title,\n    onChange: onTitleChange\n  })), __jsx(\"div\", {\n    className: styles[\"horizontal-same-line\"]\n  }, __jsx(\"div\", {\n    className: styles[\"horizontal\"]\n  }, __jsx(\"label\", null, \"Author: \"), __jsx(\"input\", {\n    className: `${styles[\"headline-form-input\"]}`,\n    type: \"text\",\n    value: formData.author,\n    onChange: onAuthorChange\n  })), __jsx(\"div\", {\n    className: styles[\"horizontal\"]\n  }, __jsx(\"label\", null, \"Date: \"), __jsx(DatePicker, {\n    className: `${styles[\"DatePicker\"]}`,\n    selected: formData.date,\n    onChange: onDateChange\n  }))), __jsx(\"div\", {\n    className: styles[\"horizontal\"]\n  }, __jsx(\"label\", null, \"Image: \"), __jsx(\"input\", {\n    className: styles[\"headline-form-input\"],\n    type: \"text\",\n    value: formData.image,\n    onChange: onImageChange\n  })), __jsx(\"input\", {\n    type: \"submit\",\n    value: \"Change Card\",\n    className: styles[\"submit-button\"]\n  })), __jsx(TextEditor, {\n    value: textEditorValue,\n    setValue: setTextEditorValue,\n    onSave: saveArticle,\n    toolbarFixed: toolbarFixed,\n    styles: styles\n  }));\n\n  return __jsx(Page, {\n    sidebarFixTopOffset: 0,\n    headline: headline,\n    mainPane: contents\n  });\n};\n\nexport async function getServerSideProps({\n  query\n}) {\n  const res = await fetch(`${process.env.NEXT_PUBLIC_DOMAIN}/api/articles/page?id=${query.id}`);\n  const json = await res.json();\n  const article = {\n    id: json._id,\n    title: json.title,\n    author: json.author,\n    date: json.date,\n    image: json.image,\n    isApproved: json.isApproved,\n    content: json.content || initialValue,\n    comments: json.comments\n  };\n  return {\n    props: {\n      article\n    }\n  };\n}\nexport default Edit;","map":{"version":3,"sources":["/home/sajalrs/ReactProgramming/article_podcast_website/pages/article/edit.js"],"names":["React","useState","useEffect","useRef","useContext","LargeCard","Page","styles","TextEditor","Value","DatePicker","HeaderContext","axios","Card","initialValue","document","nodes","object","type","leaves","text","Edit","props","textEditorValue","setTextEditorValue","fromJSON","formData","setFormData","title","author","date","Date","image","article","setArticle","headerState","headerDispatch","headerBoxRef","toolbarFixed","setToolbarFix","headlineFormRef","content","height","current","clientHeight","fixToolbar","e","window","scrollY","addEventListener","removeEventListener","keyDownHandler","keyCode","ctrlKey","preventDefault","saveArticle","scrollTo","editedArticle","toJSON","options","headers","post","JSON","stringify","then","res","alert","catch","err","response","status","data","error","Error","handleSubmit","event","onTitleChange","target","value","onAuthorChange","onDateChange","newDate","onImageChange","isPendingApproval","isApproved","headline","marginTop","ContentType","contents","getServerSideProps","query","fetch","process","env","NEXT_PUBLIC_DOMAIN","id","json","_id","comments"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, useContext } from \"react\";\nimport LargeCard from \"../../components/Cards/LargeCard/LargeCard.js\";\nimport Page from \"../../components/Page/Page\";\nimport styles from \"../../components/Page/Page.module.css\";\nimport TextEditor from \"../../components/TextEditor/TextEditor\";\nimport { Value } from \"slate\";\nimport DatePicker from \"react-datepicker\";\nimport { HeaderContext } from \"../../contexts/reducers/headerContext\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport axios from \"axios\";\nimport { Card } from \"../../components/Cards/Card\";\nconst initialValue = {\n  document: {\n    nodes: [\n      {\n        object: \"block\",\n        type: \"paragraph\",\n        nodes: [\n          {\n            object: \"text\",\n            leaves: [\n              {\n                text: \"Edit text and save to submit for moderator approval...\",\n              },\n            ],\n          },\n        ],\n      },\n    ],\n  },\n};\n\nconst Edit = (props) => {\n  const [textEditorValue, setTextEditorValue] = useState(\n    Value.fromJSON(initialValue)\n  );\n\n  const [formData, setFormData] = useState({\n    title: \"To be edited\",\n    author: \"To be edited\",\n    date: new Date(),\n    image:\n      \"data:image/png;base64,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\",\n  });\n\n  const [article, setArticle] = useState(props.article);\n  const [headerState, headerDispatch] = useContext(HeaderContext);\n  const headerBoxRef = headerState.headerBoxRef;\n  const [toolbarFixed, setToolbarFix] = useState(false);\n  const headlineFormRef = useRef();\n  useEffect(() => {\n    if (article.content) setTextEditorValue(Value.fromJSON(article.content));\n  }, [article.content])\n  useEffect(() => {\n    const height =\n      headerBoxRef && headerBoxRef.current\n        ? headerBoxRef.current.clientHeight\n        : 380;\n    const fixToolbar = (e) => {\n      if (window.scrollY > 2 * height - 66 + 644) {\n        setToolbarFix(true);\n      } else {\n        setToolbarFix(false);\n      }\n    };\n\n    window.addEventListener(\"scroll\", fixToolbar);\n    return () => {\n      window.removeEventListener(\"scroll\", fixToolbar);\n    };\n  }, [toolbarFixed]);\n\n  useEffect(() => {\n    setFormData({\n      title: article.title,\n      author: article.author,\n      date: new Date(article.date),\n      image: article.image,\n    });\n  }, [\n    article.title,\n    article.author,\n    article.author,\n    article.date,\n    article.image,\n  ]);\n\n  useEffect(() => {\n    const keyDownHandler = (e) => {\n      if (e.keyCode === 83 && e.ctrlKey) {\n        e.preventDefault();\n        saveArticle();\n      }\n    };\n\n    document.addEventListener(\"keydown\", keyDownHandler);\n    return () => {\n      document.removeEventListener(\"keydown\", keyDownHandler);\n    };\n  }, [article, textEditorValue]);\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n\n  const saveArticle = () => {\n    const editedArticle = { ...article, content: textEditorValue.toJSON() };\n    const options = {\n      headers: { \"Content-Type\": \"application/json\" },\n    };\n    axios\n      .post(\"/api/articles/edit\", JSON.stringify(editedArticle), options)\n      .then((res) => {\n        alert(\"Changes saved and submitted for moderator approval\");\n      })\n      .catch((err) => {\n        if (err.response.status === 401 || err.response.status === 400) {\n          alert(err.response.data.error);\n        } else if (err.response.status !== 200) {\n          throw Error(err);\n        }\n      });\n  };\n  const handleSubmit = (event) => {\n    event.preventDefault();\n    setArticle({\n      ...article,\n      title: formData.title,\n      author: formData.author,\n      date: formData.date,\n      image: formData.image,\n    });\n    // console.log(article);\n    // }\n  };\n\n  const onTitleChange = (event) => {\n    setFormData({\n      ...formData,\n      title: event.target.value,\n    });\n  };\n\n  const onAuthorChange = (event) => {\n    setFormData({\n      ...formData,\n      author: event.target.value,\n    });\n  };\n\n  const onDateChange = (newDate) => {\n    setFormData({\n      ...formData,\n      date: newDate,\n    });\n  };\n\n  const onImageChange = (event) => {\n    setFormData({\n      ...formData,\n      image: event.target.value,\n    });\n  };\n\n  const isPendingApproval = !article.isApproved;\n\n  const headline = (\n    <div\n      className={styles[\"headline\"]}\n      style={isPendingApproval ? { marginTop: \"36px\" } : { marginTop: \"0px\" }}\n    >\n      <LargeCard\n        title={article.title}\n        author={article.author}\n        date={article.date}\n        isApproved={article.isApproved}\n        contentType={Card.ContentType[\"article-internal\"]}\n        image={article.image}\n        onClick={() => {}}\n      />\n    </div>\n  );\n\n  const contents = (\n    <div>\n      <form\n        ref={headlineFormRef}\n        onSubmit={handleSubmit}\n        className={styles[\"headline-form\"]}\n      >\n        <div className={styles[\"horizontal\"]}>\n          <label>Title: </label>\n          <input\n            className={styles[\"headline-form-input\"]}\n            type=\"text\"\n            value={formData.title}\n            onChange={onTitleChange}\n          />\n        </div>\n        <div className={styles[\"horizontal-same-line\"]}>\n          <div className={styles[\"horizontal\"]}>\n            <label>Author: </label>\n            <input\n              className={`${styles[\"headline-form-input\"]}`}\n              type=\"text\"\n              value={formData.author}\n              onChange={onAuthorChange}\n            />\n          </div>\n          <div className={styles[\"horizontal\"]}>\n            <label>Date: </label>\n            <DatePicker\n              className={`${styles[\"DatePicker\"]}`}\n              selected={formData.date}\n              onChange={onDateChange}\n            />\n          </div>\n        </div>\n        <div className={styles[\"horizontal\"]}>\n          <label>Image: </label>\n          <input\n            className={styles[\"headline-form-input\"]}\n            type=\"text\"\n            value={formData.image}\n            onChange={onImageChange}\n          />\n        </div>\n        <input\n          type=\"submit\"\n          value=\"Change Card\"\n          className={styles[\"submit-button\"]}\n        />\n      </form>\n      <TextEditor\n        value={textEditorValue}\n        setValue={setTextEditorValue}\n        onSave={saveArticle}\n        toolbarFixed={toolbarFixed}\n        styles={styles}\n      />\n    </div>\n  );\n\n  return (\n    <Page sidebarFixTopOffset={0} headline={headline} mainPane={contents} />\n  );\n};\n\nexport async function getServerSideProps({ query }) {\n  const res = await fetch(`${process.env.NEXT_PUBLIC_DOMAIN}/api/articles/page?id=${query.id}`);\n  const json = await res.json();\n  const article = {\n        id: json._id,\n        title: json.title,\n        author: json.author,\n        date: json.date,\n        image: json.image,\n        isApproved: json.isApproved,\n        content: json.content || initialValue,\n        comments: json.comments,\n  }\n\n  return {\n    props: {\n      article,\n    },\n  };\n}\n\nexport default Edit;\n"]},"metadata":{},"sourceType":"module"}