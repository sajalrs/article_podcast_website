{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect, useContext } from \"react\";\nimport LargeCard from \"../../components/Cards/LargeCard/LargeCard.js\";\nimport Page from \"../../components/Page/Page\";\nimport styles from \"../../components/Page/Page.module.css\";\nimport Html from \"slate-html-serializer\";\nimport { getRules } from \"../../components/TextEditor/TextEditor\";\nimport CommentBar from \"../../components/Comment/CommentBar\";\nimport axios from \"axios\";\nimport { LoginContext } from \"../../contexts/reducers/loginContext\";\nimport { SocketContext } from \"../../contexts/reducers/socketContext\";\nimport { Card } from \"../../components/Cards/Card.js\";\nimport { useRouter } from \"next/router\";\n\nconst ArticlePage = props => {\n  const router = useRouter();\n  const {\n    id\n  } = router.query; // const socket = useSelector((state) => state.network.socket);\n\n  const {\n    0: loginState,\n    1: loginDispatch\n  } = useContext(LoginContext);\n  const {\n    0: socketState,\n    1: socketDispatch\n  } = useContext(SocketContext);\n  const socket = socketState.socket;\n  const user = loginState.user;\n  const {\n    0: article,\n    1: setArticle\n  } = useState(props.article);\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n  useEffect(() => {\n    const getArticle = async () => {\n      const res = await fetch(`/api/articles/page?id=${id}`);\n      const json = await res.json();\n\n      const fetchedArticle = _objectSpread(_objectSpread({}, article), {}, {\n        comments: json.comments\n      });\n\n      setArticle(fetchedArticle);\n    };\n\n    if (socket) {\n      socket.on(\"comments changed\", data => {\n        console.log(\"Comments changed\");\n\n        if (data.articleId === id) {\n          try {\n            getArticle();\n          } catch (error) {\n            console.log(error);\n          }\n        }\n      });\n    }\n  }, [socket]);\n\n  const postComment = comment => {\n    const toPost = {\n      id: id.toString(),\n      content: comment\n    };\n    const options = {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n    axios.post(\"/api/articles/postcomment\", JSON.stringify(toPost), options).then(res => {\n      alert(\"Comment Posted\");\n    }).catch(err => {\n      if (err.response.status === 401 || err.response.status === 400) {\n        alert(err.response.data.error);\n      } else if (err.response.status !== 200) {\n        throw Error(err);\n      }\n    });\n  };\n\n  const isEditable = user && (user.isModerator || user._id === article.authorId);\n  const isPendingApproval = !article.isApproved;\n\n  const headline = __jsx(\"div\", {\n    className: styles[\"headline\"],\n    style: isEditable || isPendingApproval ? {\n      marginTop: \"36px\"\n    } : {\n      marginTop: \"0px\"\n    }\n  }, __jsx(LargeCard, {\n    title: article.title,\n    author: article.author,\n    date: article.date,\n    isApproved: article.isApproved,\n    contentType: Card.ContentType[\"article-internal\"],\n    link: `article?id=${id}`,\n    isEditable: user && (user.isModerator || user._id === article.authorId),\n    image: article.image,\n    onClick: () => {}\n  }));\n\n  const contents = __jsx(\"div\", null, __jsx(\"div\", {\n    dangerouslySetInnerHTML: {\n      __html: article.content\n    }\n  }), __jsx(\"div\", {\n    className: styles[\"main-pane-item\"]\n  }, __jsx(CommentBar, {\n    postComment: postComment,\n    comments: article.comments\n  })));\n\n  return __jsx(Page // sidebarFixTopOffset={35 + 644}\n  , {\n    sidebarFixTopOffset: 0,\n    headline: headline,\n    mainPane: contents\n  });\n};\n\nexport async function getServerSideProps({\n  query\n}) {\n  const rules = getRules(styles);\n  const html = new Html({\n    rules\n  });\n  const res = await fetch(`${process.env.NEXT_PUBLIC_DOMAIN}/api/articles/page?id=${query.id}`);\n  const json = await res.json();\n  const article = {\n    title: json.title,\n    author: json.author,\n    date: json.date,\n    image: json.image,\n    isApproved: json.isApproved,\n    content: json.content ? html.serialize(json.content) : `<p></p>`,\n    comments: json.comments\n  };\n  return {\n    props: {\n      article\n    }\n  };\n}\nexport default ArticlePage;","map":{"version":3,"sources":["/home/sajalrs/ReactProgramming/article_podcast_website/pages/article/index.js"],"names":["React","useState","useEffect","useContext","LargeCard","Page","styles","Html","getRules","CommentBar","axios","LoginContext","SocketContext","Card","useRouter","ArticlePage","props","router","id","query","loginState","loginDispatch","socketState","socketDispatch","socket","user","article","setArticle","window","scrollTo","getArticle","res","fetch","json","fetchedArticle","comments","on","data","console","log","articleId","error","postComment","comment","toPost","toString","content","options","headers","post","JSON","stringify","then","alert","catch","err","response","status","Error","isEditable","isModerator","_id","authorId","isPendingApproval","isApproved","headline","marginTop","title","author","date","ContentType","image","contents","__html","getServerSideProps","rules","html","process","env","NEXT_PUBLIC_DOMAIN","serialize"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport LargeCard from \"../../components/Cards/LargeCard/LargeCard.js\";\n\nimport Page from \"../../components/Page/Page\";\nimport styles from \"../../components/Page/Page.module.css\";\nimport Html from \"slate-html-serializer\";\nimport { getRules } from \"../../components/TextEditor/TextEditor\";\nimport CommentBar from \"../../components/Comment/CommentBar\";\nimport axios from \"axios\";\nimport { LoginContext } from \"../../contexts/reducers/loginContext\";\nimport { SocketContext } from \"../../contexts/reducers/socketContext\";\nimport { Card } from \"../../components/Cards/Card.js\";\nimport { useRouter } from \"next/router\";\nconst ArticlePage = (props) => {\n  const router = useRouter();\n  const { id } = router.query;\n  // const socket = useSelector((state) => state.network.socket);\n  const [loginState, loginDispatch] = useContext(LoginContext);\n  const [socketState, socketDispatch] = useContext(SocketContext);\n  const socket = socketState.socket;\n  const user = loginState.user;\n  const [article, setArticle] = useState(props.article);\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n\n  useEffect(() => {\n    const getArticle = async () => {\n      const res = await fetch(\n        `/api/articles/page?id=${id}`\n      );\n      const json = await res.json();\n      const fetchedArticle = {\n        ...article,\n        comments: json.comments,\n      };\n      setArticle(fetchedArticle);\n    };\n\n    if (socket) {\n      socket.on(\"comments changed\", (data) => {\n        console.log(\"Comments changed\");\n        if (data.articleId === id) {\n          try {\n            getArticle();\n          } catch (error) {\n            console.log(error);\n          }\n        }\n      });\n    }\n  }, [socket]);\n\n  const postComment = (comment) => {\n    const toPost = { id: id.toString(), content: comment };\n    const options = {\n      headers: { \"Content-Type\": \"application/json\" },\n    };\n\n    axios\n      .post(\"/api/articles/postcomment\", JSON.stringify(toPost), options)\n      .then((res) => {\n        alert(\"Comment Posted\");\n      })\n      .catch((err) => {\n        if (err.response.status === 401 || err.response.status === 400) {\n          alert(err.response.data.error);\n        } else if (err.response.status !== 200) {\n          throw Error(err);\n        }\n      });\n  };\n\n  const isEditable =\n    user && (user.isModerator || user._id === article.authorId);\n  const isPendingApproval = !article.isApproved;\n\n  const headline = (\n    <div\n      className={styles[\"headline\"]}\n      style={\n        isEditable || isPendingApproval\n          ? { marginTop: \"36px\" }\n          : { marginTop: \"0px\" }\n      }\n    >\n      <LargeCard\n        title={article.title}\n        author={article.author}\n        date={article.date}\n        isApproved={article.isApproved}\n        contentType={Card.ContentType[\"article-internal\"]}\n        link={`article?id=${id}`}\n        isEditable={user && (user.isModerator || user._id === article.authorId)}\n        image={article.image}\n        onClick={() => {}}\n      />\n    </div>\n  );\n\n  const contents = (\n    <div>\n      <div dangerouslySetInnerHTML={{ __html: article.content }}></div>\n      <div className={styles[\"main-pane-item\"]}>\n        <CommentBar postComment={postComment} comments={article.comments} />\n      </div>\n    </div>\n  );\n\n  return (\n    <Page\n      // sidebarFixTopOffset={35 + 644}\n      sidebarFixTopOffset={0}\n      headline={headline}\n      mainPane={contents}\n    />\n  );\n};\n\nexport async function getServerSideProps({ query }) {\n  const rules = getRules(styles);\n  const html = new Html({ rules });\n\n  const res = await fetch(\n    `${process.env.NEXT_PUBLIC_DOMAIN}/api/articles/page?id=${query.id}`\n  );\n  const json = await res.json();\n  const article = {\n    title: json.title,\n    author: json.author,\n    date: json.date,\n    image: json.image,\n    isApproved: json.isApproved,\n    content: json.content ? html.serialize(json.content) : `<p></p>`,\n    comments: json.comments,\n  };\n\n  return {\n    props: {\n      article,\n    },\n  };\n}\n\nexport default ArticlePage;\n"]},"metadata":{},"sourceType":"module"}